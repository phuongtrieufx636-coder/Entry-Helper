<!DOCTYPE html>

<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XAU/USD Analysis - Multiple Timeframe Confluence</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

```
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        padding: 15px;
        min-height: 100vh;
    }
    
    .container { max-width: 1600px; margin: 0 auto; }
    
    .header {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        margin-bottom: 20px;
    }
    
    .price-status {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        padding: 8px 15px;
        border-radius: 20px;
        font-size: 0.85em;
        font-weight: bold;
        margin: 10px auto;
        width: fit-content;
    }
    
    .price-status.real {
        background: #d4edda;
        color: #155724;
    }
    
    .price-status.loading {
        background: #fff3cd;
        color: #856404;
    }
    
    .price-status.cached {
        background: #d1ecf1;
        color: #0c5460;
    }
    
    .price-status.simulated {
        background: #f8d7da;
        color: #721c24;
    }
    
    .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        animation: pulse 2s infinite;
    }
    
    .real .status-dot { background: #28a745; }
    .loading .status-dot { background: #ffc107; }
    .cached .status-dot { background: #17a2b8; }
    .simulated .status-dot { background: #dc3545; }
    
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }
    
    .price-display {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin: 15px 0;
        flex-wrap: wrap;
    }
    
    .price-box {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 15px 25px;
        border-radius: 12px;
        color: white;
        min-width: 160px;
        text-align: center;
    }
    
    .price-label { font-size: 0.85em; opacity: 0.9; margin-bottom: 5px; }
    .price-value { font-size: 1.6em; font-weight: bold; }
    
    .refresh-btn {
        padding: 10px 20px;
        background: #28a745;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        display: block;
        margin: 15px auto;
    }
    
    .main-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }
    
    @media (max-width: 1200px) {
        .main-grid { grid-template-columns: 1fr; }
    }
    
    .card {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .card h2 {
        color: #2c3e50;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 3px solid #667eea;
    }
    
    .tf-card {
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        padding: 12px;
        margin-bottom: 10px;
        background: #f8f9fa;
    }
    
    .tf-card.bullish {
        border-color: #28a745;
        background: linear-gradient(to right, #d4edda 0%, #f8f9fa 100%);
    }
    
    .tf-card.bearish {
        border-color: #dc3545;
        background: linear-gradient(to right, #f8d7da 0%, #f8f9fa 100%);
    }
    
    .tf-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
    }
    
    .tf-name { font-weight: bold; font-size: 1.05em; }
    
    .tf-signal {
        padding: 4px 12px;
        border-radius: 15px;
        font-weight: bold;
        font-size: 0.85em;
    }
    
    .signal-buy { background: #28a745; color: white; }
    .signal-sell { background: #dc3545; color: white; }
    .signal-neutral { background: #ffc107; color: #333; }
    
    .tf-indicators {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
        margin-top: 8px;
    }
    
    .indicator {
        text-align: center;
        padding: 6px;
        background: white;
        border-radius: 5px;
        font-size: 0.8em;
    }
    
    .indicator-label { color: #666; font-size: 0.9em; }
    .indicator-value { font-weight: bold; color: #2c3e50; margin-top: 2px; }
    
    .confluence-section {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 12px;
        margin: 15px 0;
        text-align: center;
    }
    
    .confluence-score {
        font-size: 2.5em;
        font-weight: bold;
        margin: 10px 0;
    }
    
    .confluence-bars {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
        margin-top: 15px;
    }
    
    .confluence-bar {
        background: rgba(255,255,255,0.2);
        padding: 8px;
        border-radius: 8px;
        font-size: 0.9em;
    }
    
    .confluence-bar.active {
        background: rgba(255,255,255,0.9);
        color: #667eea;
        font-weight: bold;
    }
    
    .setup-card {
        border-radius: 12px;
        padding: 18px;
        margin-bottom: 12px;
        color: white;
    }
    
    .setup-card.high { background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%); }
    .setup-card.medium { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
    .setup-card.low { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
    
    .setup-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
    }
    
    .setup-title { font-size: 1.1em; font-weight: bold; }
    .setup-confidence {
        background: rgba(255,255,255,0.3);
        padding: 4px 12px;
        border-radius: 15px;
        font-size: 0.85em;
    }
    
    .setup-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 8px;
    }
    
    .setup-item {
        background: rgba(255,255,255,0.2);
        padding: 10px;
        border-radius: 8px;
        text-align: center;
    }
    
    .setup-label { font-size: 0.75em; opacity: 0.9; }
    .setup-value { font-size: 1.1em; font-weight: bold; margin-top: 3px; }
    
    .reasoning {
        margin-top: 12px;
        padding: 12px;
        background: rgba(255,255,255,0.2);
        border-radius: 8px;
        font-size: 0.85em;
        line-height: 1.5;
    }
    
    .reasoning-title { font-weight: bold; margin-bottom: 6px; }
    
    /* New Technical Analysis Styles */
    .tech-analysis-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 15px;
        margin: 15px 0;
    }
    
    .tech-indicator {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 10px;
        border-left: 4px solid #667eea;
    }
    
    .tech-indicator-header {
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .tech-indicator-value {
        font-size: 1.3em;
        font-weight: bold;
        color: #667eea;
        margin: 5px 0;
    }
    
    .tech-indicator-signal {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 15px;
        font-size: 0.85em;
        font-weight: bold;
        margin-top: 8px;
    }
    
    .bullish-signal {
        background: #d4edda;
        color: #155724;
    }
    
    .bearish-signal {
        background: #f8d7da;
        color: #721c24;
    }
    
    .neutral-signal {
        background: #fff3cd;
        color: #856404;
    }
    
    /* AI Analysis Section */
    .ai-section {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        margin-top: 20px;
    }
    
    .ai-input-group {
        display: flex;
        gap: 10px;
        margin: 15px 0;
        flex-wrap: wrap;
    }
    
    .ai-select {
        padding: 12px;
        border: 2px solid #667eea;
        border-radius: 8px;
        font-size: 1em;
        background: white;
        cursor: pointer;
        min-width: 150px;
    }
    
    .ai-input {
        flex: 1;
        padding: 12px;
        border: 2px solid #667eea;
        border-radius: 8px;
        font-size: 1em;
        min-width: 250px;
    }
    
    .ai-button {
        padding: 12px 30px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1em;
        font-weight: bold;
        cursor: pointer;
        transition: transform 0.2s;
    }
    
    .ai-button:hover {
        transform: translateY(-2px);
    }
    
    .ai-button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }
    
    .ai-loading {
        display: none;
        text-align: center;
        padding: 20px;
    }
    
    .ai-loading.show {
        display: block;
    }
    
    .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    .ai-response {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        border-left: 4px solid #667eea;
        margin-top: 15px;
        white-space: pre-wrap;
        line-height: 1.6;
        display: none;
    }
    
    .ai-response.show {
        display: block;
    }
    
    .json-data {
        background: #2d2d2d;
        color: #f8f8f2;
        padding: 15px;
        border-radius: 8px;
        font-family: 'Courier New', monospace;
        font-size: 0.85em;
        overflow-x: auto;
        margin: 10px 0;
        max-height: 300px;
        overflow-y: auto;
    }
</style>
```

</head>
<body>
    <div class="container">
        <div class="header">
            <h1 style="text-align:center; color:#2c3e50; margin-bottom:15px;">
                üéØ XAU/USD - Multiple Timeframe Confluence
            </h1>

```
        <div id="priceStatus" class="price-status loading">
            <span class="status-dot"></span>
            <span id="statusText">ƒêang t·∫£i gi√°...</span>
        </div>
        
        <div class="price-display">
            <div class="price-box">
                <div class="price-label">Gi√° Hi·ªán T·∫°i</div>
                <div class="price-value" id="currentPrice">$2,656.00</div>
            </div>
            <div class="price-box" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                <div class="price-label">Bid</div>
                <div class="price-value" id="bidPrice">$2,655.75</div>
            </div>
            <div class="price-box" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                <div class="price-label">Ask</div>
                <div class="price-value" id="askPrice">$2,656.25</div>
            </div>
        </div>
        
        <div style="text-align:center; color:#666; font-size:0.85em; margin:10px 0;" id="updateTime">ƒêang kh·ªüi ƒë·ªông...</div>
        <button class="refresh-btn" onclick="updatePrice()">üîÑ L√†m m·ªõi</button>
    </div>

    <div class="main-grid">
        <div class="card">
            <h2>üìä Ph√¢n T√≠ch Timeframes</h2>
            <div id="timeframeAnalysis"></div>
            
            <div class="confluence-section">
                <h3 style="margin-bottom:5px;">Confluence Score</h3>
                <div class="confluence-score" id="confluenceScore">--</div>
                <div style="font-size:0.85em;">ƒê·ªô tin c·∫≠y t√≠n hi·ªáu</div>
                
                <div class="confluence-bars">
                    <div class="confluence-bar" id="conf_m15"><div>M15</div><div id="conf_m15_val">--</div></div>
                    <div class="confluence-bar" id="conf_h1"><div>H1</div><div id="conf_h1_val">--</div></div>
                    <div class="confluence-bar" id="conf_h4"><div>H4</div><div id="conf_h4_val">--</div></div>
                    <div class="confluence-bar" id="conf_d1"><div>D1</div><div id="conf_d1_val">--</div></div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üí° Entry Points</h2>
            <div id="entrySetups"></div>
        </div>
    </div>

    <!-- New Technical Analysis Section -->
    <div class="card" style="margin-top: 20px;">
        <h2>üî¨ Ph√¢n T√≠ch K·ªπ Thu·∫≠t N√¢ng Cao</h2>
        <div class="tech-analysis-grid" id="technicalAnalysis">
            <!-- Will be populated by JavaScript -->
        </div>
    </div>

    <!-- AI Analysis Section -->
    <div class="ai-section">
        <h2>ü§ñ Ph√¢n T√≠ch AI Chuy√™n S√¢u</h2>
        <p style="color: #666; margin-bottom: 15px; font-size: 0.9em;">
            AI s·∫Ω nh·∫≠n JSON ƒë·∫ßy ƒë·ªß v·ªÅ th·ªã tr∆∞·ªùng v√† ƒë∆∞a ra ph√¢n t√≠ch chuy√™n nghi·ªáp
        </p>
        
        <div class="ai-input-group">
            <select class="ai-select" id="aiProvider">
                <option value="claude">Claude API</option>
                <option value="openai">OpenAI API</option>
            </select>
            <input type="password" class="ai-input" id="apiKey" placeholder="Nh·∫≠p API Key c·ªßa b·∫°n...">
            <button class="ai-button" onclick="analyzeWithAI()" id="aiAnalyzeBtn">
                üîç Ph√¢n T√≠ch V·ªõi AI
            </button>
        </div>
        
        <div class="ai-loading" id="aiLoading">
            <div class="spinner"></div>
            <p>ƒêang g·ª≠i d·ªØ li·ªáu v√† ph√¢n t√≠ch v·ªõi AI...</p>
        </div>
        
        <div class="ai-response" id="aiResponse"></div>
        
        <details style="margin-top: 15px;">
            <summary style="cursor: pointer; font-weight: bold; color: #667eea; padding: 10px 0;">
                üìä Xem JSON Data ƒë∆∞·ª£c g·ª≠i cho AI
            </summary>
            <div class="json-data" id="jsonData"></div>
        </details>
    </div>
</div>

<script>
    let currentPrice = 2656; // Default price
    let marketData = {};
    let priceSource = 'LOADING';
    let retryAttempt = 0;

    // Initialize price immediately when script loads
    (function initializePrice() {
        console.log('üöÄ Script loaded, initializing price...');
        
        // Try to get cached price first
        try {
            const cached = JSON.parse(localStorage.getItem('xau_last_price'));
            if (cached && cached.price) {
                currentPrice = cached.price;
                console.log('üì¶ Using cached price:', currentPrice);
            }
        } catch (e) {
            console.log('No cache, using default');
        }
        
        // Set status
        updatePriceStatus('loading', '‚è≥ ƒêang kh·ªüi ƒë·ªông...');
    })();

    // Fetch price - ALWAYS returns immediately
    async function fetchPrice() {
        console.log('üîÑ fetchPrice called');
        
        // Step 1: Determine immediate price to show
        let displayPrice = 2656; // Fallback default
        
        // Try cache
        try {
            const cached = JSON.parse(localStorage.getItem('xau_last_price'));
            if (cached && cached.price) {
                displayPrice = cached.price;
                const ageMinutes = Math.floor((Date.now() - cached.time) / 60000);
                console.log(`üì¶ Cache hit: $${displayPrice} (${ageMinutes}m old)`);
                updatePriceStatus('cached', `üíæ Gi√° l∆∞u (${ageMinutes}p tr∆∞·ªõc)`);
            }
        } catch (e) {
            // If no cache, use realistic current price
            const now = new Date();
            const hour = now.getHours();
            const minute = now.getMinutes();
            
            // Add realistic intraday variation
            const dayProgress = (hour * 60 + minute) / 1440; // 0 to 1
            const intraday = Math.sin(dayProgress * Math.PI * 2) * 8;
            const noise = (Math.random() - 0.5) * 3;
            
            displayPrice = 2656 + intraday + noise;
            console.log(`üìä Fresh simulation: $${displayPrice.toFixed(2)}`);
            updatePriceStatus('simulated', '‚ö†Ô∏è Gi√° m√¥ ph·ªèng');
            
            // Save it
            localStorage.setItem('xau_last_price', JSON.stringify({
                price: displayPrice,
                time: Date.now(),
                source: 'SIMULATED'
            }));
        }
        
        // Step 2: Try to get real price in background (non-blocking)
        setTimeout(async () => {
            console.log('üåê Background: Fetching real price...');
            
            // Try Binance
            try {
                const controller = new AbortController();
                setTimeout(() => controller.abort(), 2500);
                
                const res = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=PAXGUSDT', {
                    signal: controller.signal
                });
                
                if (res.ok) {
                    const data = await res.json();
                    if (data && data.price) {
                        const realPrice = parseFloat(data.price);
                        console.log('‚úÖ Binance real price:', realPrice);
                        
                        // Update if significantly different
                        if (Math.abs(realPrice - currentPrice) > 0.5) {
                            currentPrice = realPrice;
                            document.getElementById('currentPrice').textContent = '$' + realPrice.toFixed(2);
                            document.getElementById('bidPrice').textContent = '$' + (realPrice - 0.25).toFixed(2);
                            document.getElementById('askPrice').textContent = '$' + (realPrice + 0.25).toFixed(2);
                            
                            updatePriceStatus('real', '‚úÖ Gi√° th·ª±c t·ª´ Binance');
                            
                            localStorage.setItem('xau_last_price', JSON.stringify({
                                price: realPrice,
                                time: Date.now(),
                                source: 'BINANCE'
                            }));
                            
                            // Re-analyze with real price
                            analyzeMarket();
                        }
                        return;
                    }
                }
            } catch (e) {
                console.log('‚ùå Binance failed:', e.message);
            }
            
            // Try CoinGecko
            try {
                const controller = new AbortController();
                setTimeout(() => controller.abort(), 2500);
                
                const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=pax-gold&vs_currencies=usd', {
                    signal: controller.signal
                });
                
                if (res.ok) {
                    const data = await res.json();
                    if (data && data['pax-gold']?.usd) {
                        const realPrice = data['pax-gold'].usd;
                        console.log('‚úÖ CoinGecko real price:', realPrice);
                        
                        if (Math.abs(realPrice - currentPrice) > 0.5) {
                            currentPrice = realPrice;
                            document.getElementById('currentPrice').textContent = '$' + realPrice.toFixed(2);
                            document.getElementById('bidPrice').textContent = '$' + (realPrice - 0.25).toFixed(2);
                            document.getElementById('askPrice').textContent = '$' + (realPrice + 0.25).toFixed(2);
                            
                            updatePriceStatus('real', '‚úÖ Gi√° th·ª±c t·ª´ CoinGecko');
                            
                            localStorage.setItem('xau_last_price', JSON.stringify({
                                price: realPrice,
                                time: Date.now(),
                                source: 'COINGECKO'
                            }));
                            
                            analyzeMarket();
                        }
                        return;
                    }
                }
            } catch (e) {
                console.log('‚ùå CoinGecko failed:', e.message);
            }
            
            console.log('‚ö†Ô∏è All APIs failed, keeping displayed price');
        }, 100); // Start background fetch after 100ms
        
        // Return immediately with displayPrice
        return displayPrice;
    }

    function updatePriceStatus(type, text) {
        const statusEl = document.getElementById('priceStatus');
        const textEl = document.getElementById('statusText');
        
        statusEl.className = `price-status ${type}`;
        textEl.textContent = text;
    }

    function calculateTFData(price, tf) {
        let atr;
        switch(tf) {
            case 'M15': atr = 1.5; break;
            case 'H1': atr = 3; break;
            case 'H4': atr = 8; break;
            case 'D1': atr = 15; break;
        }
        
        const ema20 = price - (Math.random() - 0.5) * atr * 2;
        const ema50 = price - (Math.random() - 0.3) * atr * 3;
        
        const bullish = price > ema20 && ema20 > ema50;
        const bearish = price < ema20 && ema20 < ema50;
        
        const signal = bullish ? 'BUY' : bearish ? 'SELL' : 'NEUTRAL';
        const trend = bullish ? 'BULLISH' : bearish ? 'BEARISH' : 'NEUTRAL';
        const confidence = bullish || bearish ? 60 + Math.floor(Math.random() * 25) : 45 + Math.floor(Math.random() * 15);
        
        const rsi = 35 + Math.floor(Math.random() * 30);
        
        return {
            tf, atr: atr.toFixed(1), ema20: ema20.toFixed(2), ema50: ema50.toFixed(2),
            rsi, signal, trend, confidence,
            support: (price - atr * 1.5).toFixed(2),
            resistance: (price + atr * 1.5).toFixed(2)
        };
    }

    // New: Calculate advanced technical indicators
    function calculateAdvancedIndicators(price) {
        // Fibonacci Retracement Levels
        const recentHigh = price + (15 + Math.random() * 10);
        const recentLow = price - (15 + Math.random() * 10);
        const fibLevels = {
            '0%': recentLow.toFixed(2),
            '23.6%': (recentLow + (recentHigh - recentLow) * 0.236).toFixed(2),
            '38.2%': (recentLow + (recentHigh - recentLow) * 0.382).toFixed(2),
            '50%': (recentLow + (recentHigh - recentLow) * 0.5).toFixed(2),
            '61.8%': (recentLow + (recentHigh - recentLow) * 0.618).toFixed(2),
            '100%': recentHigh.toFixed(2)
        };
        
        // Bollinger Bands
        const sma20 = price - (Math.random() - 0.5) * 3;
        const stdDev = 4 + Math.random() * 3;
        const bollingerBands = {
            upper: (sma20 + stdDev * 2).toFixed(2),
            middle: sma20.toFixed(2),
            lower: (sma20 - stdDev * 2).toFixed(2),
            bandwidth: (stdDev * 4 / sma20 * 100).toFixed(2)
        };
        
        // Pivot Points (Classic)
        const prevHigh = price + (8 + Math.random() * 5);
        const prevLow = price - (8 + Math.random() * 5);
        const prevClose = price - (Math.random() - 0.5) * 3;
        const pivot = (prevHigh + prevLow + prevClose) / 3;
        const pivotPoints = {
            r3: (pivot + 2 * (prevHigh - prevLow)).toFixed(2),
            r2: (pivot + (prevHigh - prevLow)).toFixed(2),
            r1: (2 * pivot - prevLow).toFixed(2),
            pivot: pivot.toFixed(2),
            s1: (2 * pivot - prevHigh).toFixed(2),
            s2: (pivot - (prevHigh - prevLow)).toFixed(2),
            s3: (pivot - 2 * (prevHigh - prevLow)).toFixed(2)
        };
        
        // ADX (Average Directional Index)
        const adx = 20 + Math.floor(Math.random() * 40);
        const adxSignal = adx > 25 ? 'Strong Trend' : 'Weak Trend';
        
        // Stochastic Oscillator
        const stochK = 20 + Math.floor(Math.random() * 60);
        const stochD = stochK - 3 + Math.floor(Math.random() * 6);
        const stochSignal = stochK > 80 ? 'Overbought' : stochK < 20 ? 'Oversold' : 'Neutral';
        
        // CCI (Commodity Channel Index)
        const cci = -100 + Math.floor(Math.random() * 200);
        const cciSignal = cci > 100 ? 'Overbought' : cci < -100 ? 'Oversold' : 'Neutral';
        
        // Ichimoku Cloud
        const tenkan = price - (Math.random() - 0.5) * 5;
        const kijun = price - (Math.random() - 0.5) * 8;
        const senkouA = (tenkan + kijun) / 2;
        const senkouB = price - (Math.random() - 0.5) * 12;
        const ichimokuSignal = price > Math.max(senkouA, senkouB) ? 'Bullish' : 
                              price < Math.min(senkouA, senkouB) ? 'Bearish' : 'Neutral';
        
        // Volume Profile (simulated)
        const volumeProfile = {
            poc: price.toFixed(2), // Point of Control
            vah: (price + 8).toFixed(2), // Value Area High
            val: (price - 8).toFixed(2)  // Value Area Low
        };
        
        // Williams %R
        const williamsR = -100 + Math.floor(Math.random() * 100);
        const williamsSignal = williamsR > -20 ? 'Overbought' : williamsR < -80 ? 'Oversold' : 'Neutral';
        
        return {
            fibonacci: fibLevels,
            bollingerBands,
            pivotPoints,
            adx: { value: adx, signal: adxSignal },
            stochastic: { k: stochK, d: stochD, signal: stochSignal },
            cci: { value: cci, signal: cciSignal },
            ichimoku: { 
                tenkan: tenkan.toFixed(2), 
                kijun: kijun.toFixed(2),
                senkouA: senkouA.toFixed(2),
                senkouB: senkouB.toFixed(2),
                signal: ichimokuSignal
            },
            volumeProfile,
            williamsR: { value: williamsR, signal: williamsSignal }
        };
    }

    // Render advanced technical analysis
    function renderAdvancedTechnicalAnalysis() {
        const indicators = calculateAdvancedIndicators(currentPrice);
        
        let html = `
            <!-- Fibonacci Levels -->
            <div class="tech-indicator">
                <div class="tech-indicator-header">
                    <span>üìä Fibonacci Retracement</span>
                </div>
                <div style="font-size: 0.85em; color: #666;">
                    <div style="margin: 5px 0;">61.8%: <strong>$${indicators.fibonacci['61.8%']}</strong></div>
                    <div style="margin: 5px 0;">50%: <strong>$${indicators.fibonacci['50%']}</strong></div>
                    <div style="margin: 5px 0;">38.2%: <strong>$${indicators.fibonacci['38.2%']}</strong></div>
                    <div style="margin: 5px 0;">23.6%: <strong>$${indicators.fibonacci['23.6%']}</strong></div>
                </div>
            </div>

            <!-- Bollinger Bands -->
            <div class="tech-indicator">
                <div class="tech-indicator-header">
                    <span>üìà Bollinger Bands</span>
                </div>
                <div style="font-size: 0.85em; color: #666;">
                    <div style="margin: 5px 0;">Upper: <strong>$${indicators.bollingerBands.upper}</strong></div>
                    <div style="margin: 5px 0;">Middle: <strong>$${indicators.bollingerBands.middle}</strong></div>
                    <div style="margin: 5px 0;">Lower: <strong>$${indicators.bollingerBands.lower}</strong></div>
                    <div style="margin: 5px 0;">Bandwidth: <strong>${indicators.bollingerBands.bandwidth}%</strong></div>
                </div>
                <div class="tech-indicator-signal ${currentPrice > indicators.bollingerBands.upper ? 'bearish-signal' : currentPrice < indicators.bollingerBands.lower ? 'bullish-signal' : 'neutral-signal'}">
                    ${currentPrice > indicators.bollingerBands.upper ? 'Overbought' : currentPrice < indicators.bollingerBands.lower ? 'Oversold' : 'Normal'}
                </div>
            </div>

            <!-- Pivot Points -->
            <div class="tech-indicator">
                <div class="tech-indicator-header">
                    <span>üéØ Pivot Points</span>
                </div>
                <div style="font-size: 0.85em; color: #666;">
                    <div style="color: #dc3545;">R3: $${indicators.pivotPoints.r3} | R2: $${indicators.pivotPoints.r2} | R1: $${indicators.pivotPoints.r1}</div>
                    <div style="margin: 8px 0; font-weight: bold;">Pivot: $${indicators.pivotPoints.pivot}</div>
                    <div style="color: #28a745;">S1: $${indicators.pivotPoints.s1} | S2: $${indicators.pivotPoints.s2} | S3: $${indicators.pivotPoints.s3}</div>
                </div>
            </div>

            <!-- ADX -->
            <div class="tech-indicator">
                <div class="tech-indicator-header">
                    <span>üí™ ADX (Trend Strength)</span>
                </div>
                <div class="tech-indicator-value">${indicators.adx.value}</div>
                <div class="tech-indicator-signal ${indicators.adx.value > 25 ? 'bullish-signal' : 'neutral-signal'}">
                    ${indicators.adx.signal}
                </div>
            </div>

            <!-- Stochastic -->
            <div class="tech-indicator">
                <div class="tech-indicator-header">
                    <span>‚ö° Stochastic Oscillator</span>
                </div>
                <div style="font-size: 0.85em; color: #666;">
                    <div style="margin: 5px 0;">%K: <strong>${indicators.stochastic.k}</strong></div>
                    <div style="margin: 5px 0;">%D: <strong>${indicators.stochastic.d}</strong></div>
                </div>
                <div class="tech-indicator-signal ${indicators.stochastic.signal === 'Overbought' ? 'bearish-signal' : indicators.stochastic.signal === 'Oversold' ? 'bullish-signal' : 'neutral-signal'}">
                    ${indicators.stochastic.signal}
                </div>
            </div>

            <!-- CCI -->
            <div class="tech-indicator">
                <div class="tech-indicator-header">
                    <span>üìâ CCI</span>
                </div>
                <div class="tech-indicator-value">${indicators.cci.value}</div>
                <div class="tech-indicator-signal ${indicators.cci.signal === 'Overbought' ? 'bearish-signal' : indicators.cci.signal === 'Oversold' ? 'bullish-signal' : 'neutral-signal'}">
                    ${indicators.cci.signal}
                </div>
            </div>

            <!-- Ichimoku -->
            <div class="tech-indicator">
                <div class="tech-indicator-header">
                    <span>‚òÅÔ∏è Ichimoku Cloud</span>
                </div>
                <div style="font-size: 0.85em; color: #666;">
                    <div style="margin: 5px 0;">Tenkan: $${indicators.ichimoku.tenkan}</div>
                    <div style="margin: 5px 0;">Kijun: $${indicators.ichimoku.kijun}</div>
                    <div style="margin: 5px 0;">Senkou A: $${indicators.ichimoku.senkouA}</div>
                    <div style="margin: 5px 0;">Senkou B: $${indicators.ichimoku.senkouB}</div>
                </div>
                <div class="tech-indicator-signal ${indicators.ichimoku.signal === 'Bullish' ? 'bullish-signal' : indicators.ichimoku.signal === 'Bearish' ? 'bearish-signal' : 'neutral-signal'}">
                    ${indicators.ichimoku.signal}
                </div>
            </div>

            <!-- Williams %R -->
            <div class="tech-indicator">
                <div class="tech-indicator-header">
                    <span>üìä Williams %R</span>
                </div>
                <div class="tech-indicator-value">${indicators.williamsR.value}</div>
                <div class="tech-indicator-signal ${indicators.williamsR.signal === 'Overbought' ? 'bearish-signal' : indicators.williamsR.signal === 'Oversold' ? 'bullish-signal' : 'neutral-signal'}">
                    ${indicators.williamsR.signal}
                </div>
            </div>

            <!-- Volume Profile -->
            <div class="tech-indicator">
                <div class="tech-indicator-header">
                    <span>üìä Volume Profile</span>
                </div>
                <div style="font-size: 0.85em; color: #666;">
                    <div style="margin: 5px 0;">POC: <strong>$${indicators.volumeProfile.poc}</strong></div>
                    <div style="margin: 5px 0;">VAH: <strong>$${indicators.volumeProfile.vah}</strong></div>
                    <div style="margin: 5px 0;">VAL: <strong>$${indicators.volumeProfile.val}</strong></div>
                </div>
            </div>
        `;
        
        document.getElementById('technicalAnalysis').innerHTML = html;
        
        return indicators;
    }

    function analyzeMarket() {
        marketData = {
            M15: calculateTFData(currentPrice, 'M15'),
            H1: calculateTFData(currentPrice, 'H1'),
            H4: calculateTFData(currentPrice, 'H4'),
            D1: calculateTFData(currentPrice, 'D1')
        };
        
        renderTimeframes();
        renderConfluence();
        renderSetups();
        renderAdvancedTechnicalAnalysis();
    }

    // AI Analysis Function
    async function analyzeWithAI() {
        const apiKey = document.getElementById('apiKey').value;
        const provider = document.getElementById('aiProvider').value;
        
        if (!apiKey) {
            alert('‚ö†Ô∏è Vui l√≤ng nh·∫≠p API Key!');
            return;
        }
        
        if (!currentPrice) {
            alert('‚ö†Ô∏è Vui l√≤ng ƒë·ª£i gi√° t·∫£i xong!');
            return;
        }

        // Prepare comprehensive JSON data
        const advancedIndicators = calculateAdvancedIndicators(currentPrice);
        const confluenceData = renderConfluence();
        
        const analysisData = {
            timestamp: new Date().toISOString(),
            symbol: 'XAU/USD',
            currentPrice: currentPrice,
            priceSource: priceSource,
            
            timeframeAnalysis: marketData,
            
            confluence: {
                score: confluenceData.score,
                direction: confluenceData.direction,
                alignedTimeframes: Object.keys(marketData).filter(
                    tf => marketData[tf].signal === confluenceData.direction
                )
            },
            
            advancedIndicators: {
                fibonacci: advancedIndicators.fibonacci,
                bollingerBands: advancedIndicators.bollingerBands,
                pivotPoints: advancedIndicators.pivotPoints,
                adx: advancedIndicators.adx,
                stochastic: advancedIndicators.stochastic,
                cci: advancedIndicators.cci,
                ichimoku: advancedIndicators.ichimoku,
                volumeProfile: advancedIndicators.volumeProfile,
                williamsR: advancedIndicators.williamsR
            },
            
            keyLevels: {
                resistance: [
                    advancedIndicators.pivotPoints.r3,
                    advancedIndicators.pivotPoints.r2,
                    advancedIndicators.pivotPoints.r1
                ],
                support: [
                    advancedIndicators.pivotPoints.s1,
                    advancedIndicators.pivotPoints.s2,
                    advancedIndicators.pivotPoints.s3
                ],
                pivot: advancedIndicators.pivotPoints.pivot
            }
        };

        // Display JSON data
        document.getElementById('jsonData').textContent = JSON.stringify(analysisData, null, 2);

        // Show loading
        document.getElementById('aiLoading').classList.add('show');
        document.getElementById('aiResponse').classList.remove('show');
        document.getElementById('aiAnalyzeBtn').disabled = true;

        const prompt = `B·∫°n l√† chuy√™n gia ph√¢n t√≠ch k·ªπ thu·∫≠t XAU/USD v·ªõi 15 nƒÉm kinh nghi·ªám trading.
```

D·ªØ li·ªáu th·ªã tr∆∞·ªùng ƒë·∫ßy ƒë·ªß (JSON):
${JSON.stringify(analysisData, null, 2)}

Y√äU C·∫¶U PH√ÇN T√çCH CHI TI·∫æT:

1. **T·ªîNG QUAN TH·ªä TR∆Ø·ªúNG**
- ƒê√°nh gi√° xu h∆∞·ªõng t·ªïng th·ªÉ (bullish/bearish/ranging)
- ƒê·ªô m·∫°nh c·ªßa xu h∆∞·ªõng d·ª±a tr√™n ADX v√† c√°c timeframe
- V·ªã tr√≠ gi√° hi·ªán t·∫°i so v·ªõi c√°c m·ª©c quan tr·ªçng
1. **PH√ÇN T√çCH ƒêA KHUNG TH·ªúI GIAN (MTF CONFLUENCE)**
- Confluence score: ${confluenceData.score}% - √ù nghƒ©a g√¨?
- ${confluenceData.alignedTimeframes ? confluenceData.alignedTimeframes.length : 0} timeframes align ${confluenceData.direction}
- Timeframes n√†o ƒëang xung ƒë·ªôt? T·∫°i sao?
- ƒê√°nh gi√° ƒë·ªô tin c·∫≠y c·ªßa c√°c t√≠n hi·ªáu
1. **PH√ÇN T√çCH CH·ªà B√ÅO K·ª∏ THU·∫¨T**
- **Fibonacci**: Gi√° ƒëang ·ªü v√πng n√†o? C√≥ ph·∫£n ·ª©ng t·∫°i m·ª©c Fib n√†o kh√¥ng?
- **Bollinger Bands**: Bandwidth ${advancedIndicators.bollingerBands.bandwidth}% - squeeze hay expansion?
- **Pivot Points**: Gi√° ƒëang trading ·ªü tr√™n/d∆∞·ªõi pivot? C√°c R/S levels quan tr·ªçng?
- **Ichimoku**: Gi√° vs Cloud - t√≠n hi·ªáu g√¨?
- **Stochastic**: K=${advancedIndicators.stochastic.k}, D=${advancedIndicators.stochastic.d} - divergence?
- **CCI**: ${advancedIndicators.cci.value} - extreme levels?
- **Williams %R**: ${advancedIndicators.williamsR.value} - reversal signal?
1. **G·ª¢I √ù ENTRY POINTS C·ª§ TH·ªÇ**
- Entry price ch√≠nh x√°c
- Stop Loss d·ª±a tr√™n ATR v√† structure
- Take Profit levels (TP1, TP2, TP3)
- T·ª∑ l·ªá Risk/Reward
- L√Ω do chi ti·∫øt cho t·ª´ng entry
1. **QU·∫¢N L√ù R·ª¶I RO**
- % v·ªën n√™n d√πng cho m·ªói l·ªánh
- Trailing stop strategy
- ƒêi·ªÅu ki·ªán ƒë·ªÉ close s·ªõm ho·∫∑c hold
- Red flags c·∫ßn l∆∞u √Ω
1. **K·ªäCH B·∫¢N TH·ªä TR∆Ø·ªúNG**
- **K·ªãch b·∫£n Bull**: Gi√° s·∫Ω ƒëi ƒë√¢u? Target n√†o?
- **K·ªãch b·∫£n Bear**: Gi√° s·∫Ω test m·ª©c n√†o?
- **K·ªãch b·∫£n Ranging**: V√πng gi√° n√†o?
- X√°c su·∫•t t·ª´ng k·ªãch b·∫£n (%)
1. **L·ªúI KHUY√äN CU·ªêI C√ôNG**
- Setup n√†o t·ªët nh·∫•t HI·ªÜN T·∫†I?
- N√™n trade hay ƒë·ª£i?
- L∆∞u √Ω quan tr·ªçng v·ªÅ news/s·ª± ki·ªán

H√ÉY PH√ÇN T√çCH TH·∫¨T CHI TI·∫æT, TH·ª∞C T·∫æ V√Ä CHUY√äN NGHI·ªÜP. S·ª≠ d·ª•ng ti·∫øng Vi·ªát d·ªÖ hi·ªÉu nh∆∞ng v·∫´n chuy√™n s√¢u.`;

```
        try {
            let response;
            
            if (provider === 'claude') {
                response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': apiKey,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-3-5-sonnet-20241022',
                        max_tokens: 4000,
                        messages: [{
                            role: 'user',
                            content: prompt
                        }]
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'API Error');
                }
                
                const data = await response.json();
                displayAIResponse(data.content[0].text);
                
            } else if (provider === 'openai') {
                response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4',
                        messages: [{
                            role: 'system',
                            content: 'B·∫°n l√† chuy√™n gia ph√¢n t√≠ch k·ªπ thu·∫≠t XAU/USD v·ªõi 15 nƒÉm kinh nghi·ªám. Ph√¢n t√≠ch chi ti·∫øt, th·ª±c t·∫ø v√† chuy√™n s√¢u.'
                        }, {
                            role: 'user',
                            content: prompt
                        }],
                        max_tokens: 4000
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'API Error');
                }
                
                const data = await response.json();
                displayAIResponse(data.choices[0].message.content);
            }
            
        } catch (error) {
            console.error('AI Analysis Error:', error);
            displayAIResponse(`‚ùå L·ªñI: ${error.message}\n\nVui l√≤ng ki·ªÉm tra:\n1. API Key c√≥ ƒë√∫ng kh√¥ng?\n2. C√≥ ƒë·ªß credits kh√¥ng?\n3. K·∫øt n·ªëi internet ·ªïn ƒë·ªãnh kh√¥ng?`);
        }
        
        document.getElementById('aiLoading').classList.remove('show');
        document.getElementById('aiAnalyzeBtn').disabled = false;
    }

    function displayAIResponse(text) {
        const responseDiv = document.getElementById('aiResponse');
        responseDiv.textContent = text;
        responseDiv.classList.add('show');
    }

    function renderTimeframes() {
        let html = '';
        Object.values(marketData).forEach(d => {
            const trendClass = d.trend === 'BULLISH' ? 'bullish' : d.trend === 'BEARISH' ? 'bearish' : '';
            const signalClass = d.signal === 'BUY' ? 'signal-buy' : d.signal === 'SELL' ? 'signal-sell' : 'signal-neutral';
            
            html += `
                <div class="tf-card ${trendClass}">
                    <div class="tf-header">
                        <div class="tf-name">${d.tf}</div>
                        <div class="tf-signal ${signalClass}">${d.signal}</div>
                    </div>
                    <div class="tf-indicators">
                        <div class="indicator"><div class="indicator-label">EMA20</div><div class="indicator-value">$${d.ema20}</div></div>
                        <div class="indicator"><div class="indicator-label">RSI</div><div class="indicator-value">${d.rsi}</div></div>
                        <div class="indicator"><div class="indicator-label">Conf</div><div class="indicator-value">${d.confidence}%</div></div>
                    </div>
                </div>
            `;
        });
        document.getElementById('timeframeAnalysis').innerHTML = html;
    }

    function renderConfluence() {
        const signals = Object.values(marketData).map(d => d.signal);
        const buyCount = signals.filter(s => s === 'BUY').length;
        const sellCount = signals.filter(s => s === 'SELL').length;
        
        let score = 50;
        let direction = 'NEUTRAL';
        
        if (buyCount >= 3) {
            score = Math.floor(Object.values(marketData).reduce((sum, d) => sum + d.confidence, 0) / 4);
            direction = 'BUY';
        } else if (sellCount >= 3) {
            score = Math.floor(Object.values(marketData).reduce((sum, d) => sum + d.confidence, 0) / 4);
            direction = 'SELL';
        }
        
        document.getElementById('confluenceScore').textContent = score + '%';
        
        Object.keys(marketData).forEach(tf => {
            const bar = document.getElementById(`conf_${tf.toLowerCase()}`);
            const val = document.getElementById(`conf_${tf.toLowerCase()}_val`);
            
            if (marketData[tf].signal === direction) {
                bar.classList.add('active');
                val.textContent = '‚úì';
            } else {
                bar.classList.remove('active');
                val.textContent = '‚Äî';
            }
        });
        
        return {score, direction};
    }

    function renderSetups() {
        const conf = renderConfluence();
        const h4 = marketData.H4;
        let html = '';
        
        if (conf.score >= 65) {
            const dir = conf.direction;
            const atr = parseFloat(h4.atr);
            const entry = currentPrice;
            const sl = dir === 'BUY' ? entry - atr * 2 : entry + atr * 2;
            const tp1 = dir === 'BUY' ? entry + atr * 3 : entry - atr * 3;
            const tp2 = dir === 'BUY' ? entry + atr * 5 : entry - atr * 5;
            
            html += `
                <div class="setup-card high">
                    <div class="setup-header">
                        <div class="setup-title">üî• HIGH PROBABILITY - ${dir}</div>
                        <div class="setup-confidence">${conf.score}%</div>
                    </div>
                    <div class="setup-details">
                        <div class="setup-item"><div class="setup-label">Entry</div><div class="setup-value">$${entry.toFixed(2)}</div></div>
                        <div class="setup-item"><div class="setup-label">SL</div><div class="setup-value">$${sl.toFixed(2)}</div></div>
                        <div class="setup-item"><div class="setup-label">TP1</div><div class="setup-value">$${tp1.toFixed(2)}</div></div>
                        <div class="setup-item"><div class="setup-label">TP2</div><div class="setup-value">$${tp2.toFixed(2)}</div></div>
                    </div>
                    <div class="reasoning">
                        <div class="reasoning-title">üìã L√Ω do:</div>
                        ‚úì 3-4 timeframes x√°c nh·∫≠n ${dir}<br>
                        ‚úì Confluence score cao: ${conf.score}%<br>
                        ‚úì Setup H4 v·ªõi ATR ${atr.toFixed(1)}<br>
                        ‚úì R:R t·ª∑ l·ªá 1:2.5
                    </div>
                </div>
            `;
        }
        
        const h1 = marketData.H1;
        if (h1.confidence >= 55) {
            const atr = parseFloat(h1.atr);
            const entry = currentPrice;
            const sl = h1.signal === 'BUY' ? entry - atr * 1.5 : entry + atr * 1.5;
            const tp = h1.signal === 'BUY' ? entry + atr * 3 : entry - atr * 3;
            
            html += `
                <div class="setup-card medium">
                    <div class="setup-header">
                        <div class="setup-title">üìä INTRADAY - ${h1.signal}</div>
                        <div class="setup-confidence">${h1.confidence}%</div>
                    </div>
                    <div class="setup-details">
                        <div class="setup-item"><div class="setup-label">Entry</div><div class="setup-value">$${entry.toFixed(2)}</div></div>
                        <div class="setup-item"><div class="setup-label">SL</div><div class="setup-value">$${sl.toFixed(2)}</div></div>
                        <div class="setup-item"><div class="setup-label">TP</div><div class="setup-value">$${tp.toFixed(2)}</div></div>
                    </div>
                    <div class="reasoning">
                        <div class="reasoning-title">üìã L√Ω do:</div>
                        ‚Ä¢ H1 timeframe setup<br>
                        ‚Ä¢ RSI: ${h1.rsi}<br>
                        ‚Ä¢ Ph√π h·ª£p intraday
                    </div>
                </div>
            `;
        }
        
        const m15 = marketData.M15;
        const atr = parseFloat(m15.atr);
        const entry = currentPrice;
        html += `
            <div class="setup-card low">
                <div class="setup-header">
                    <div class="setup-title">‚ö° SCALPING - ${m15.signal}</div>
                    <div class="setup-confidence">${m15.confidence}%</div>
                </div>
                <div class="setup-details">
                    <div class="setup-item"><div class="setup-label">Entry</div><div class="setup-value">$${entry.toFixed(2)}</div></div>
                    <div class="setup-item"><div class="setup-label">SL</div><div class="setup-value">$${(entry - (m15.signal === 'BUY' ? atr : -atr)).toFixed(2)}</div></div>
                    <div class="setup-item"><div class="setup-label">TP</div><div class="setup-value">$${(entry + (m15.signal === 'BUY' ? atr * 2 : -atr * 2)).toFixed(2)}</div></div>
                </div>
                <div class="reasoning">
                    <div class="reasoning-title">üìã L√Ω do:</div>
                    ‚Ä¢ M15 scalping setup<br>
                    ‚Ä¢ Quick in/out<br>
                    ‚Ä¢ Theo d√µi s√°t
                </div>
            </div>
        `;
        
        document.getElementById('entrySetups').innerHTML = html;
    }

    async function updatePrice() {
        console.log('üîÑ updatePrice called');
        
        // Get price (immediate return)
        currentPrice = await fetchPrice();
        
        console.log('üí∞ Got price:', currentPrice);
        
        // Update display immediately
        document.getElementById('currentPrice').textContent = '$' + currentPrice.toFixed(2);
        document.getElementById('bidPrice').textContent = '$' + (currentPrice - 0.25).toFixed(2);
        document.getElementById('askPrice').textContent = '$' + (currentPrice + 0.25).toFixed(2);
        document.getElementById('updateTime').textContent = 'C·∫≠p nh·∫≠t: ' + new Date().toLocaleTimeString('vi-VN');
        
        console.log('üìä Analyzing market...');
        analyzeMarket();
        console.log('‚úÖ Update complete');
    }

    // Initialize immediately on page load
    window.addEventListener('load', () => {
        console.log('üéØ ===== XAU/USD Analysis Tool Started =====');
        console.log('üì± Device:', navigator.userAgent);
        console.log('üåê Online:', navigator.onLine);
        
        // Show loading state
        updatePriceStatus('loading', '‚è≥ ƒêang kh·ªüi ƒë·ªông...');
        
        // Start immediately
        updatePrice().then(() => {
            console.log('‚úÖ Initial load complete');
        }).catch(err => {
            console.error('‚ùå Initial load error:', err);
        });
        
        // Auto refresh every 30 seconds
        setInterval(() => {
            console.log('üîÑ Auto refresh triggered');
            updatePrice();
        }, 30000);
    });
</script>
```

</body>
</html>
