<!DOCTYPE html>

<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ph√¢n T√≠ch XAU/USD - Professional Trading Analysis</title>
    <script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        color: #e0e0e0;
        padding: 20px;
        min-height: 100vh;
    }

    .container {
        max-width: 1800px;
        margin: 0 auto;
    }

    .header {
        text-align: center;
        padding: 20px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        margin-bottom: 20px;
        backdrop-filter: blur(10px);
    }

    .header h1 {
        color: #ffd700;
        font-size: 2.5em;
        margin-bottom: 10px;
        text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
    }

    .live-price {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        margin-top: 15px;
        font-size: 1.8em;
        font-weight: bold;
    }

    .price-value {
        color: #4caf50;
        text-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
    }

    .price-change {
        font-size: 0.7em;
        padding: 5px 10px;
        border-radius: 5px;
    }

    .price-up {
        color: #4caf50;
        background: rgba(76, 175, 80, 0.2);
    }

    .price-down {
        color: #f44336;
        background: rgba(244, 67, 54, 0.2);
    }

    .main-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }

    .chart-container {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 20px;
        backdrop-filter: blur(10px);
    }

    .tradingview-widget {
        height: 500px;
        border-radius: 10px;
        overflow: hidden;
    }

    .analysis-panel {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 20px;
        backdrop-filter: blur(10px);
    }

    .panel-title {
        font-size: 1.5em;
        color: #ffd700;
        margin-bottom: 15px;
        border-bottom: 2px solid rgba(255, 215, 0, 0.3);
        padding-bottom: 10px;
    }

    .timeframe-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }

    .timeframe-tab {
        padding: 10px 20px;
        background: rgba(255, 255, 255, 0.1);
        border: none;
        border-radius: 8px;
        color: #e0e0e0;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: bold;
    }

    .timeframe-tab:hover {
        background: rgba(255, 215, 0, 0.2);
    }

    .timeframe-tab.active {
        background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
        color: #1a1a2e;
    }

    .signal-card {
        background: linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(76, 175, 80, 0.05) 100%);
        border-left: 4px solid #4caf50;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 15px;
    }

    .signal-card.sell {
        background: linear-gradient(135deg, rgba(244, 67, 54, 0.1) 0%, rgba(244, 67, 54, 0.05) 100%);
        border-left-color: #f44336;
    }

    .signal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }

    .signal-type {
        font-size: 1.3em;
        font-weight: bold;
    }

    .signal-type.buy {
        color: #4caf50;
    }

    .signal-type.sell {
        color: #f44336;
    }

    .signal-style {
        background: rgba(255, 255, 255, 0.1);
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.9em;
    }

    .signal-details {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        margin-top: 15px;
    }

    .signal-detail {
        background: rgba(255, 255, 255, 0.05);
        padding: 10px;
        border-radius: 8px;
    }

    .signal-detail-label {
        font-size: 0.9em;
        color: #999;
        margin-bottom: 5px;
    }

    .signal-detail-value {
        font-size: 1.2em;
        font-weight: bold;
        color: #ffd700;
    }

    .confluence-meter {
        margin-top: 20px;
        padding: 15px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
    }

    .confluence-bar {
        height: 30px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        overflow: hidden;
        margin-top: 10px;
    }

    .confluence-fill {
        height: 100%;
        background: linear-gradient(90deg, #4caf50 0%, #8bc34a 50%, #ffd700 100%);
        transition: width 0.5s;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: #1a1a2e;
    }

    .indicators-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        margin-top: 15px;
    }

    .indicator-item {
        display: flex;
        justify-content: space-between;
        padding: 10px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
    }

    .indicator-signal {
        padding: 3px 10px;
        border-radius: 5px;
        font-size: 0.9em;
        font-weight: bold;
    }

    .indicator-signal.bullish {
        background: rgba(76, 175, 80, 0.3);
        color: #4caf50;
    }

    .indicator-signal.bearish {
        background: rgba(244, 67, 54, 0.3);
        color: #f44336;
    }

    .indicator-signal.neutral {
        background: rgba(255, 193, 7, 0.3);
        color: #ffc107;
    }

    .ai-panel {
        background: rgba(138, 43, 226, 0.1);
        border: 2px solid rgba(138, 43, 226, 0.3);
        border-radius: 15px;
        padding: 20px;
        margin-top: 20px;
    }

    .api-config {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 20px;
    }

    .input-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .input-group label {
        color: #ffd700;
        font-weight: bold;
    }

    .input-group input, .input-group select {
        padding: 12px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        color: #e0e0e0;
        font-size: 1em;
    }

    .analyze-btn {
        width: 100%;
        padding: 15px;
        background: linear-gradient(135deg, #8a2be2 0%, #9d4edd 100%);
        border: none;
        border-radius: 10px;
        color: white;
        font-size: 1.1em;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
    }

    .analyze-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(138, 43, 226, 0.4);
    }

    .analyze-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .ai-result {
        margin-top: 20px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        max-height: 400px;
        overflow-y: auto;
    }

    .loading {
        text-align: center;
        padding: 20px;
        color: #ffd700;
    }

    .spinner {
        border: 3px solid rgba(255, 255, 255, 0.1);
        border-top: 3px solid #ffd700;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .risk-warning {
        background: rgba(255, 152, 0, 0.1);
        border-left: 4px solid #ff9800;
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
        font-size: 0.9em;
    }

    @media (max-width: 1200px) {
        .main-grid {
            grid-template-columns: 1fr;
        }
        
        .signal-details {
            grid-template-columns: 1fr;
        }
    }

    .last-update {
        text-align: center;
        color: #999;
        font-size: 0.9em;
        margin-top: 10px;
    }
</style>
```

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Ph√¢n T√≠ch XAU/USD Chuy√™n Nghi·ªáp</h1>
            <div class="live-price">
                <span>Gi√° Hi·ªán T·∫°i:</span>
                <span class="price-value" id="currentPrice">ƒêang t·∫£i...</span>
                <span class="price-change price-up" id="priceChange">+0.00 (0.00%)</span>
            </div>
            <div class="last-update" id="lastUpdate">C·∫≠p nh·∫≠t l·∫ßn cu·ªëi: --:--:--</div>
        </div>

```
    <div class="main-grid">
        <div class="chart-container">
            <div class="panel-title">üìà Bi·ªÉu ƒê·ªì Gi√° Th·ª±c (TradingView)</div>
            <div class="tradingview-widget" id="tradingview_chart"></div>
        </div>

        <div class="analysis-panel">
            <div class="panel-title">üéØ T√≠n Hi·ªáu Giao D·ªãch</div>
            
            <div class="timeframe-tabs">
                <button class="timeframe-tab active" data-timeframe="M5">M5</button>
                <button class="timeframe-tab" data-timeframe="M15">M15</button>
                <button class="timeframe-tab" data-timeframe="M30">M30</button>
                <button class="timeframe-tab" data-timeframe="H1">H1</button>
                <button class="timeframe-tab" data-timeframe="H4">H4</button>
                <button class="timeframe-tab" data-timeframe="D1">D1</button>
            </div>

            <div id="signalsContainer">
                <!-- Signals will be populated here -->
            </div>

            <div class="confluence-meter">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-weight: bold;">üé≤ ƒê·ªô Tin C·∫≠y (Confluence)</span>
                    <span id="confluencePercent" style="color: #ffd700; font-weight: bold;">0%</span>
                </div>
                <div class="confluence-bar">
                    <div class="confluence-fill" id="confluenceFill" style="width: 0%;">0%</div>
                </div>
            </div>

            <div class="indicators-grid" id="indicatorsGrid">
                <!-- Indicators will be populated here -->
            </div>
        </div>
    </div>

    <div class="ai-panel">
        <div class="panel-title">ü§ñ Ph√¢n T√≠ch AI Chuy√™n S√¢u</div>
        
        <div class="api-config">
            <div class="input-group">
                <label>Ch·ªçn AI Provider:</label>
                <select id="aiProvider">
                    <option value="claude">Claude (Anthropic)</option>
                    <option value="openai">OpenAI (GPT-4)</option>
                </select>
            </div>
            <div class="input-group">
                <label>API Key:</label>
                <input type="password" id="apiKey" placeholder="Nh·∫≠p API key c·ªßa b·∫°n...">
            </div>
        </div>

        <button class="analyze-btn" id="analyzeBtn">
            üîç Ph√¢n T√≠ch B·∫±ng AI
        </button>

        <div id="aiResult" class="ai-result" style="display: none;"></div>
    </div>

    <div class="risk-warning">
        ‚ö†Ô∏è <strong>C·∫£nh b√°o r·ªßi ro:</strong> Giao d·ªãch forex v√† v√†ng c√≥ r·ªßi ro cao. T√≠n hi·ªáu ch·ªâ mang t√≠nh ch·∫•t tham kh·∫£o. 
        Lu√¥n s·ª≠ d·ª•ng stop loss v√† qu·∫£n l√Ω v·ªën h·ª£p l√Ω. Kh√¥ng bao gi·ªù ƒë·∫ßu t∆∞ s·ªë ti·ªÅn b·∫°n kh√¥ng th·ªÉ m·∫•t.
    </div>
</div>

<script>
    // TradingView Widget
    new TradingView.widget({
        "width": "100%",
        "height": 500,
        "symbol": "OANDA:XAUUSD",
        "interval": "15",
        "timezone": "Asia/Ho_Chi_Minh",
        "theme": "dark",
        "style": "1",
        "locale": "vi_VN",
        "toolbar_bg": "#f1f3f6",
        "enable_publishing": false,
        "allow_symbol_change": true,
        "container_id": "tradingview_chart",
        "studies": [
            "RSI@tv-basicstudies",
            "MASimple@tv-basicstudies",
            "MACD@tv-basicstudies"
        ]
    });

    // State management
    let currentTimeframe = 'M5';
    let currentPrice = 0;
    let previousPrice = 0;
    let chartData = {};

    // Fetch real-time price from TradingView
    async function fetchRealPrice() {
        try {
            const response = await fetch('https://query1.finance.yahoo.com/v8/finance/chart/GC=F');
            const data = await response.json();
            
            if (data.chart && data.chart.result && data.chart.result[0]) {
                const quote = data.chart.result[0].meta;
                previousPrice = currentPrice;
                currentPrice = quote.regularMarketPrice;
                
                updatePriceDisplay();
                return currentPrice;
            }
        } catch (error) {
            console.error('Error fetching price:', error);
        }
        return null;
    }

    function updatePriceDisplay() {
        const priceElement = document.getElementById('currentPrice');
        const changeElement = document.getElementById('priceChange');
        const updateElement = document.getElementById('lastUpdate');
        
        priceElement.textContent = currentPrice.toFixed(2);
        
        if (previousPrice > 0) {
            const change = currentPrice - previousPrice;
            const changePercent = (change / previousPrice * 100).toFixed(2);
            
            changeElement.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)} (${changePercent}%)`;
            changeElement.className = `price-change ${change >= 0 ? 'price-up' : 'price-down'}`;
        }
        
        const now = new Date();
        updateElement.textContent = `C·∫≠p nh·∫≠t l·∫ßn cu·ªëi: ${now.toLocaleTimeString('vi-VN')}`;
    }

    // Technical Analysis Functions
    function calculateRSI(prices, period = 14) {
        if (prices.length < period) return 50;
        
        let gains = 0;
        let losses = 0;
        
        for (let i = prices.length - period; i < prices.length; i++) {
            const change = prices[i] - prices[i - 1];
            if (change > 0) gains += change;
            else losses += Math.abs(change);
        }
        
        const avgGain = gains / period;
        const avgLoss = losses / period;
        
        if (avgLoss === 0) return 100;
        const rs = avgGain / avgLoss;
        return 100 - (100 / (1 + rs));
    }

    function calculateMACD(prices) {
        const ema12 = calculateEMA(prices, 12);
        const ema26 = calculateEMA(prices, 26);
        return ema12 - ema26;
    }

    function calculateEMA(prices, period) {
        if (prices.length === 0) return 0;
        const multiplier = 2 / (period + 1);
        let ema = prices[0];
        
        for (let i = 1; i < prices.length; i++) {
            ema = (prices[i] - ema) * multiplier + ema;
        }
        
        return ema;
    }

    function calculateBollingerBands(prices, period = 20) {
        if (prices.length < period) return { upper: 0, middle: 0, lower: 0 };
        
        const recentPrices = prices.slice(-period);
        const sma = recentPrices.reduce((a, b) => a + b, 0) / period;
        
        const squaredDiffs = recentPrices.map(price => Math.pow(price - sma, 2));
        const variance = squaredDiffs.reduce((a, b) => a + b, 0) / period;
        const stdDev = Math.sqrt(variance);
        
        return {
            upper: sma + (stdDev * 2),
            middle: sma,
            lower: sma - (stdDev * 2)
        };
    }

    // Generate trading signals
    function generateSignals(timeframe) {
        const signals = [];
        
        // Simulate price history for analysis
        const priceHistory = generatePriceHistory(currentPrice, 100);
        
        const rsi = calculateRSI(priceHistory);
        const macd = calculateMACD(priceHistory);
        const bb = calculateBollingerBands(priceHistory);
        const sma50 = calculateEMA(priceHistory, 50);
        const sma200 = calculateEMA(priceHistory, 200);
        
        // Scalping Signal
        if (timeframe === 'M5' || timeframe === 'M15') {
            let scalpSignal = 'BUY';
            let confluence = 0;
            
            if (rsi < 30) confluence += 25;
            if (rsi > 70) { scalpSignal = 'SELL'; confluence += 25; }
            if (currentPrice < bb.lower) confluence += 25;
            if (currentPrice > bb.upper) { scalpSignal = 'SELL'; confluence += 25; }
            if (macd > 0 && scalpSignal === 'BUY') confluence += 25;
            if (macd < 0 && scalpSignal === 'SELL') confluence += 25;
            
            const range = currentPrice * 0.002; // 0.2% range
            
            signals.push({
                type: scalpSignal,
                style: 'SCALPING',
                entry: currentPrice,
                tp: scalpSignal === 'BUY' ? currentPrice + range : currentPrice - range,
                sl: scalpSignal === 'BUY' ? currentPrice - range * 0.5 : currentPrice + range * 0.5,
                confluence: Math.min(confluence, 100)
            });
        }
        
        // Swing Signal
        if (timeframe === 'H1' || timeframe === 'H4' || timeframe === 'D1') {
            let swingSignal = sma50 > sma200 ? 'BUY' : 'SELL';
            let confluence = 0;
            
            if (sma50 > sma200) confluence += 30;
            else confluence += 30;
            
            if (rsi < 40 && swingSignal === 'BUY') confluence += 20;
            if (rsi > 60 && swingSignal === 'SELL') confluence += 20;
            
            if (macd > 0 && swingSignal === 'BUY') confluence += 25;
            if (macd < 0 && swingSignal === 'SELL') confluence += 25;
            
            if (currentPrice > bb.middle && swingSignal === 'BUY') confluence += 25;
            if (currentPrice < bb.middle && swingSignal === 'SELL') confluence += 25;
            
            const range = currentPrice * 0.015; // 1.5% range
            
            signals.push({
                type: swingSignal,
                style: 'SWING',
                entry: currentPrice,
                tp: swingSignal === 'BUY' ? currentPrice + range : currentPrice - range,
                sl: swingSignal === 'BUY' ? currentPrice - range * 0.4 : currentPrice + range * 0.4,
                confluence: Math.min(confluence, 100)
            });
        }
        
        // Store technical indicators
        chartData[timeframe] = {
            rsi: rsi,
            macd: macd,
            bb: bb,
            sma50: sma50,
            sma200: sma200,
            signals: signals
        };
        
        return signals;
    }

    function generatePriceHistory(currentPrice, length) {
        const prices = [currentPrice];
        for (let i = 1; i < length; i++) {
            const change = (Math.random() - 0.5) * currentPrice * 0.001;
            prices.unshift(currentPrice - change * i);
        }
        return prices;
    }

    function renderSignals(timeframe) {
        const signals = generateSignals(timeframe);
        const container = document.getElementById('signalsContainer');
        
        container.innerHTML = signals.map(signal => `
            <div class="signal-card ${signal.type.toLowerCase()}">
                <div class="signal-header">
                    <span class="signal-type ${signal.type.toLowerCase()}">${signal.type === 'BUY' ? 'üü¢ MUA' : 'üî¥ B√ÅN'}</span>
                    <span class="signal-style">‚ö° ${signal.style}</span>
                </div>
                <div class="signal-details">
                    <div class="signal-detail">
                        <div class="signal-detail-label">Entry Point</div>
                        <div class="signal-detail-value">${signal.entry.toFixed(2)}</div>
                    </div>
                    <div class="signal-detail">
                        <div class="signal-detail-label">Take Profit</div>
                        <div class="signal-detail-value">${signal.tp.toFixed(2)}</div>
                    </div>
                    <div class="signal-detail">
                        <div class="signal-detail-label">Stop Loss</div>
                        <div class="signal-detail-value">${signal.sl.toFixed(2)}</div>
                    </div>
                </div>
                <div style="margin-top: 10px; font-size: 0.9em; color: #999;">
                    Risk/Reward: ${((signal.tp - signal.entry) / (signal.entry - signal.sl)).toFixed(2)}
                </div>
            </div>
        `).join('');
        
        // Update confluence
        const avgConfluence = signals.reduce((sum, s) => sum + s.confluence, 0) / signals.length;
        updateConfluence(avgConfluence);
        
        // Update indicators
        renderIndicators(timeframe);
    }

    function updateConfluence(percent) {
        const fill = document.getElementById('confluenceFill');
        const percentText = document.getElementById('confluencePercent');
        
        fill.style.width = percent + '%';
        fill.textContent = Math.round(percent) + '%';
        percentText.textContent = Math.round(percent) + '%';
    }

    function renderIndicators(timeframe) {
        const data = chartData[timeframe];
        if (!data) return;
        
        const indicators = [
            { name: 'RSI', value: data.rsi.toFixed(2), signal: data.rsi < 30 ? 'bullish' : data.rsi > 70 ? 'bearish' : 'neutral' },
            { name: 'MACD', value: data.macd.toFixed(2), signal: data.macd > 0 ? 'bullish' : 'bearish' },
            { name: 'SMA 50/200', value: data.sma50 > data.sma200 ? 'Golden Cross' : 'Death Cross', 
              signal: data.sma50 > data.sma200 ? 'bullish' : 'bearish' },
            { name: 'Bollinger', value: currentPrice > data.bb.upper ? 'Overbought' : currentPrice < data.bb.lower ? 'Oversold' : 'Normal',
              signal: currentPrice < data.bb.lower ? 'bullish' : currentPrice > data.bb.upper ? 'bearish' : 'neutral' }
        ];
        
        const container = document.getElementById('indicatorsGrid');
        container.innerHTML = indicators.map(ind => `
            <div class="indicator-item">
                <span>${ind.name}: ${ind.value}</span>
                <span class="indicator-signal ${ind.signal}">${
                    ind.signal === 'bullish' ? 'üü¢ TƒÉng' : 
                    ind.signal === 'bearish' ? 'üî¥ Gi·∫£m' : '‚ö™ Trung L·∫≠p'
                }</span>
            </div>
        `).join('');
    }

    // Timeframe tabs
    document.querySelectorAll('.timeframe-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('.timeframe-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            currentTimeframe = tab.dataset.timeframe;
            renderSignals(currentTimeframe);
        });
    });

    // AI Analysis
    document.getElementById('analyzeBtn').addEventListener('click', async () => {
        const provider = document.getElementById('aiProvider').value;
        const apiKey = document.getElementById('apiKey').value;
        const resultDiv = document.getElementById('aiResult');
        const btn = document.getElementById('analyzeBtn');
        
        if (!apiKey) {
            alert('Vui l√≤ng nh·∫≠p API key!');
            return;
        }
        
        btn.disabled = true;
        btn.textContent = '‚è≥ ƒêang ph√¢n t√≠ch...';
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>AI ƒëang ph√¢n t√≠ch d·ªØ li·ªáu...</p></div>';
        
        try {
            const analysisData = prepareAnalysisData();
            const aiResponse = await callAI(provider, apiKey, analysisData);
            
            resultDiv.innerHTML = `
                <h3 style="color: #ffd700; margin-bottom: 15px;">üìä K·∫øt Qu·∫£ Ph√¢n T√≠ch AI:</h3>
                <div style="line-height: 1.8; white-space: pre-wrap;">${aiResponse}</div>
            `;
        } catch (error) {
            resultDiv.innerHTML = `
                <div style="color: #f44336;">
                    ‚ùå L·ªói: ${error.message}
                </div>
            `;
        } finally {
            btn.disabled = false;
            btn.textContent = 'üîç Ph√¢n T√≠ch B·∫±ng AI';
        }
    });

    function prepareAnalysisData() {
        const data = chartData[currentTimeframe];
        return {
            symbol: 'XAU/USD',
            currentPrice: currentPrice,
            timeframe: currentTimeframe,
            timestamp: new Date().toISOString(),
            technicalIndicators: {
                rsi: data.rsi,
                macd: data.macd,
                bollingerBands: data.bb,
                sma50: data.sma50,
                sma200: data.sma200
            },
            signals: data.signals,
            marketCondition: data.sma50 > data.sma200 ? 'BULLISH' : 'BEARISH'
        };
    }

    async function callAI(provider, apiKey, analysisData) {
        const prompt = `B·∫°n l√† chuy√™n gia ph√¢n t√≠ch k·ªπ thu·∫≠t XAU/USD. H√£y ph√¢n t√≠ch d·ªØ li·ªáu sau v√† ƒë∆∞a ra nh·∫≠n ƒë·ªãnh chi ti·∫øt:
```

D·ªØ li·ªáu th·ªã tr∆∞·ªùng:
${JSON.stringify(analysisData, null, 2)}

Y√™u c·∫ßu ph√¢n t√≠ch:

1. ƒê√°nh gi√° xu h∆∞·ªõng t·ªïng th·ªÉ
1. Ph√¢n t√≠ch c√°c ch·ªâ b√°o k·ªπ thu·∫≠t (RSI, MACD, Bollinger Bands, SMA)
1. ƒê√°nh gi√° ƒë·ªô tin c·∫≠y c·ªßa t√≠n hi·ªáu giao d·ªãch
1. ƒê·ªÅ xu·∫•t chi·∫øn l∆∞·ª£c v√†o l·ªánh v√† qu·∫£n l√Ω r·ªßi ro
1. C·∫£nh b√°o c√°c y·∫øu t·ªë c·∫ßn l∆∞u √Ω

Tr·∫£ l·ªùi b·∫±ng ti·∫øng Vi·ªát, r√µ r√†ng v√† chuy√™n nghi·ªáp.`;

```
        if (provider === 'claude') {
            return await callClaude(apiKey, prompt);
        } else {
            return await callOpenAI(apiKey, prompt);
        }
    }

    async function callClaude(apiKey, prompt) {
        const response = await fetch('https://api.anthropic.com/v1/messages', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'x-api-key': apiKey,
                'anthropic-version': '2023-06-01'
            },
            body: JSON.stringify({
                model: 'claude-sonnet-4-20250514',
                max_tokens: 2000,
                messages: [{
                    role: 'user',
                    content: prompt
                }]
            })
        });

        if (!response.ok) {
            throw new Error(`Claude API error: ${response.status} ${response.statusText}`);
        }

        const data = await response.json();
        return data.content[0].text;
    }

    async function callOpenAI(apiKey, prompt) {
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${apiKey}`
            },
            body: JSON.stringify({
                model: 'gpt-4',
                messages: [{
                    role: 'user',
                    content: prompt
                }],
                max_tokens: 2000
            })
        });

        if (!response.ok) {
            throw new Error(`OpenAI API error: ${response.status} ${response.statusText}`);
        }

        const data = await response.json();
        return data.choices[0].message.content;
    }

    // Initialize
    async function initialize() {
        await fetchRealPrice();
        renderSignals(currentTimeframe);
        
        // Update price every 5 seconds
        setInterval(fetchRealPrice, 5000);
        
        // Update signals every 30 seconds
        setInterval(() => renderSignals(currentTimeframe), 30000);
    }

    initialize();
</script>
```

</body>
</html>
