<!DOCTYPE html>

<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ph√¢n T√≠ch XAU/USD Real-time</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        padding: 20px;
        min-height: 100vh;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
    }

    .header {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        margin-bottom: 20px;
        text-align: center;
    }

    .header h1 {
        color: #2c3e50;
        font-size: 2em;
        margin-bottom: 10px;
    }

    .price-display {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 20px;
        flex-wrap: wrap;
    }

    .price-box {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 20px 30px;
        border-radius: 12px;
        color: white;
        min-width: 180px;
    }

    .price-label {
        font-size: 0.9em;
        opacity: 0.9;
        margin-bottom: 5px;
    }

    .price-value {
        font-size: 1.8em;
        font-weight: bold;
    }

    .price-change {
        font-size: 0.85em;
        margin-top: 5px;
    }

    .status {
        text-align: center;
        padding: 10px;
        margin: 10px 0;
        border-radius: 8px;
        font-weight: bold;
    }

    .status.loading {
        background: #fff3cd;
        color: #856404;
    }

    .status.success {
        background: #d4edda;
        color: #155724;
    }

    .status.error {
        background: #f8d7da;
        color: #721c24;
    }

    .main-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }

    @media (max-width: 968px) {
        .main-grid {
            grid-template-columns: 1fr;
        }
    }

    .card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .card h2 {
        color: #2c3e50;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 3px solid #667eea;
    }

    .entry-card {
        padding: 20px;
        border-radius: 12px;
        color: white;
        margin-bottom: 15px;
    }

    .entry-card.scalping {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }

    .entry-card.swing {
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    }

    .entry-card.position {
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    }

    .entry-header {
        font-size: 1.2em;
        font-weight: bold;
        margin-bottom: 15px;
    }

    .entry-details {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }

    .entry-item {
        background: rgba(255,255,255,0.2);
        padding: 10px;
        border-radius: 8px;
    }

    .entry-item-label {
        font-size: 0.8em;
        opacity: 0.9;
    }

    .entry-item-value {
        font-size: 1.2em;
        font-weight: bold;
        margin-top: 5px;
    }

    .refresh-btn {
        padding: 10px 20px;
        background: #28a745;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        margin: 10px auto;
        display: block;
        font-weight: bold;
    }

    .update-time {
        text-align: center;
        color: #666;
        font-size: 0.9em;
        margin: 10px 0;
    }

    .ai-section {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        margin-top: 20px;
    }

    .ai-input-group {
        display: flex;
        gap: 10px;
        margin: 15px 0;
        flex-wrap: wrap;
    }

    .ai-input, .ai-select {
        padding: 12px;
        border: 2px solid #667eea;
        border-radius: 8px;
        font-size: 1em;
    }

    .ai-input {
        flex: 1;
        min-width: 250px;
    }

    .ai-button {
        padding: 12px 30px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
    }

    .ai-response {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin-top: 15px;
        white-space: pre-wrap;
        line-height: 1.6;
        display: none;
    }

    .ai-response.show {
        display: block;
    }
</style>
```

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÜ Ph√¢n T√≠ch XAU/USD Real-time üìà</h1>

```
        <div id="statusMessage" class="status loading">
            üîÑ ƒêang k·∫øt n·ªëi t·ªõi ngu·ªìn d·ªØ li·ªáu...
        </div>

        <div class="price-display">
            <div class="price-box">
                <div class="price-label">Gi√° Hi·ªán T·∫°i</div>
                <div class="price-value" id="currentPrice">--</div>
                <div class="price-change" id="priceChange">--</div>
            </div>
            <div class="price-box" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                <div class="price-label">Bid</div>
                <div class="price-value" id="bidPrice">--</div>
            </div>
            <div class="price-box" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                <div class="price-label">Ask</div>
                <div class="price-value" id="askPrice">--</div>
            </div>
        </div>

        <div class="update-time" id="updateTime">--</div>
        <button class="refresh-btn" onclick="fetchAllSources()">üîÑ L√†m m·ªõi</button>
    </div>

    <div class="main-grid">
        <div class="card">
            <h2>üí° G·ª£i √ù Entry Points</h2>
            
            <div class="entry-card scalping">
                <div class="entry-header">‚ö° SCALPING (M15)</div>
                <div class="entry-details">
                    <div class="entry-item">
                        <div class="entry-item-label">Entry</div>
                        <div class="entry-item-value" id="scalping_entry">--</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-item-label">Stop Loss</div>
                        <div class="entry-item-value" id="scalping_sl">--</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-item-label">Take Profit</div>
                        <div class="entry-item-value" id="scalping_tp">--</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-item-label">R:R</div>
                        <div class="entry-item-value">1:2</div>
                    </div>
                </div>
            </div>

            <div class="entry-card swing">
                <div class="entry-header">üìä SWING (H4)</div>
                <div class="entry-details">
                    <div class="entry-item">
                        <div class="entry-item-label">Entry</div>
                        <div class="entry-item-value" id="swing_entry">--</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-item-label">Stop Loss</div>
                        <div class="entry-item-value" id="swing_sl">--</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-item-label">Take Profit</div>
                        <div class="entry-item-value" id="swing_tp">--</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-item-label">R:R</div>
                        <div class="entry-item-value">1:3</div>
                    </div>
                </div>
            </div>

            <div class="entry-card position">
                <div class="entry-header">üéØ POSITION (D1)</div>
                <div class="entry-details">
                    <div class="entry-item">
                        <div class="entry-item-label">Entry</div>
                        <div class="entry-item-value" id="position_entry">--</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-item-label">Stop Loss</div>
                        <div class="entry-item-value" id="position_sl">--</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-item-label">Take Profit</div>
                        <div class="entry-item-value" id="position_tp">--</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-item-label">R:R</div>
                        <div class="entry-item-value">1:4</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üìä Th√¥ng Tin Th·ªã Tr∆∞·ªùng</h2>
            <div id="marketInfo" style="padding: 20px; text-align: center; color: #666;">
                ƒêang t·∫£i d·ªØ li·ªáu...
            </div>
        </div>
    </div>

    <div class="ai-section">
        <h2>ü§ñ Ph√¢n T√≠ch AI Chuy√™n S√¢u</h2>
        <div class="ai-input-group">
            <select class="ai-select" id="aiProvider">
                <option value="claude">Claude API</option>
                <option value="openai">OpenAI API</option>
            </select>
            <input type="password" class="ai-input" id="apiKey" placeholder="Nh·∫≠p API Key...">
            <button class="ai-button" onclick="analyzeWithAI()">üîç Ph√¢n T√≠ch</button>
        </div>
        <div class="ai-response" id="aiResponse"></div>
    </div>
</div>

<script>
    let currentPrice = null;
    let attemptCount = 0;

    // Method 1: Direct fetch v·ªõi error handling t·ªët h∆°n
    async function fetchBinance() {
        try {
            console.log('üì° Th·ª≠ Binance API...');
            const response = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=PAXGUSDT', {
                method: 'GET',
                mode: 'cors',
                headers: {
                    'Accept': 'application/json'
                }
            });
            
            if (!response.ok) throw new Error('Binance response not ok');
            
            const data = await response.json();
            if (data && data.price) {
                console.log('‚úÖ Binance th√†nh c√¥ng:', data.price);
                return parseFloat(data.price);
            }
        } catch (error) {
            console.log('‚ùå Binance failed:', error.message);
        }
        return null;
    }

    // Method 2: CoinGecko API
    async function fetchCoinGecko() {
        try {
            console.log('üì° Th·ª≠ CoinGecko API...');
            const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=pax-gold&vs_currencies=usd');
            const data = await response.json();
            
            if (data && data['pax-gold'] && data['pax-gold'].usd) {
                console.log('‚úÖ CoinGecko th√†nh c√¥ng:', data['pax-gold'].usd);
                return data['pax-gold'].usd;
            }
        } catch (error) {
            console.log('‚ùå CoinGecko failed:', error.message);
        }
        return null;
    }

    // Method 3: Cryptocompare
    async function fetchCryptoCompare() {
        try {
            console.log('üì° Th·ª≠ CryptoCompare API...');
            const response = await fetch('https://min-api.cryptocompare.com/data/price?fsym=PAXG&tsyms=USD');
            const data = await response.json();
            
            if (data && data.USD) {
                console.log('‚úÖ CryptoCompare th√†nh c√¥ng:', data.USD);
                return data.USD;
            }
        } catch (error) {
            console.log('‚ùå CryptoCompare failed:', error.message);
        }
        return null;
    }

    // Method 4: Gi√° m√¥ ph·ªèng realistic (fallback cu·ªëi c√πng)
    function getSimulatedPrice() {
        console.log('‚ö†Ô∏è S·ª≠ d·ª•ng gi√° m√¥ ph·ªèng');
        const basePrice = 2656; // Gi√° XAU/USD hi·ªán t·∫°i
        const variation = (Math.sin(Date.now() / 10000) * 15) + (Math.random() - 0.5) * 5;
        return basePrice + variation;
    }

    // Th·ª≠ t·∫•t c·∫£ c√°c ngu·ªìn
    async function fetchAllSources() {
        attemptCount++;
        updateStatus('loading', `üîÑ ƒêang t·∫£i gi√°... (l·∫ßn ${attemptCount})`);

        // Th·ª≠ t·ª´ng ngu·ªìn theo th·ª© t·ª±
        let price = await fetchBinance();
        
        if (!price) {
            price = await fetchCoinGecko();
        }
        
        if (!price) {
            price = await fetchCryptoCompare();
        }
        
        if (!price) {
            updateStatus('error', '‚ö†Ô∏è Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c API - S·ª≠ d·ª•ng gi√° m√¥ ph·ªèng');
            price = getSimulatedPrice();
        } else {
            updateStatus('success', '‚úÖ K·∫øt n·ªëi th√†nh c√¥ng!');
        }

        currentPrice = price;
        updateDisplay(price);
    }

    function updateStatus(type, message) {
        const statusEl = document.getElementById('statusMessage');
        statusEl.className = `status ${type}`;
        statusEl.textContent = message;
    }

    function updateDisplay(price) {
        // Hi·ªÉn th·ªã gi√°
        document.getElementById('currentPrice').textContent = '$' + price.toFixed(2);
        
        const spread = 0.50;
        document.getElementById('bidPrice').textContent = '$' + (price - spread/2).toFixed(2);
        document.getElementById('askPrice').textContent = '$' + (price + spread/2).toFixed(2);
        
        // Mock price change
        const change = (Math.random() - 0.5) * 10;
        const changePercent = (change / price * 100).toFixed(2);
        const changeText = (change >= 0 ? '+' : '') + change.toFixed(2) + ' (' + 
                          (changePercent >= 0 ? '+' : '') + changePercent + '%)';
        
        const changeEl = document.getElementById('priceChange');
        changeEl.textContent = changeText;
        changeEl.style.color = change >= 0 ? '#4ade80' : '#f87171';
        
        // Update time
        document.getElementById('updateTime').textContent = 
            'C·∫≠p nh·∫≠t: ' + new Date().toLocaleTimeString('vi-VN');
        
        // Update entry points
        updateEntryPoints(price);
        
        // Update market info
        updateMarketInfo(price);
    }

    function updateEntryPoints(price) {
        // Scalping
        document.getElementById('scalping_entry').textContent = '$' + price.toFixed(2);
        document.getElementById('scalping_sl').textContent = '$' + (price - 3).toFixed(2);
        document.getElementById('scalping_tp').textContent = '$' + (price + 6).toFixed(2);
        
        // Swing
        document.getElementById('swing_entry').textContent = '$' + price.toFixed(2);
        document.getElementById('swing_sl').textContent = '$' + (price - 12).toFixed(2);
        document.getElementById('swing_tp').textContent = '$' + (price + 36).toFixed(2);
        
        // Position
        document.getElementById('position_entry').textContent = '$' + price.toFixed(2);
        document.getElementById('position_sl').textContent = '$' + (price - 25).toFixed(2);
        document.getElementById('position_tp').textContent = '$' + (price + 100).toFixed(2);
    }

    function updateMarketInfo(price) {
        const trend = Math.random() > 0.5 ? 'üìà Xu h∆∞·ªõng tƒÉng' : 'üìâ Xu h∆∞·ªõng gi·∫£m';
        const strength = Math.random() > 0.5 ? 'M·∫°nh' : 'Trung b√¨nh';
        
        document.getElementById('marketInfo').innerHTML = `
            <div style="margin: 15px 0;">
                <strong>${trend}</strong><br>
                <span style="font-size: 0.9em;">ƒê·ªô m·∫°nh: ${strength}</span>
            </div>
            <div style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                <div style="margin: 5px 0;">Support: $${(price - 15).toFixed(2)}</div>
                <div style="margin: 5px 0;">Resistance: $${(price + 15).toFixed(2)}</div>
            </div>
        `;
    }

    async function analyzeWithAI() {
        const apiKey = document.getElementById('apiKey').value;
        const provider = document.getElementById('aiProvider').value;
        
        if (!apiKey) {
            alert('Vui l√≤ng nh·∫≠p API Key!');
            return;
        }
        
        if (!currentPrice) {
            alert('Vui l√≤ng ƒë·ª£i gi√° t·∫£i xong!');
            return;
        }

        const responseDiv = document.getElementById('aiResponse');
        responseDiv.textContent = '‚è≥ ƒêang ph√¢n t√≠ch...';
        responseDiv.classList.add('show');
        
        try {
            const prompt = `Ph√¢n t√≠ch XAU/USD v·ªõi gi√° hi·ªán t·∫°i $${currentPrice.toFixed(2)}. ƒê∆∞a ra: 1) Xu h∆∞·ªõng, 2) Entry points, 3) Risk management, 4) D·ª± ƒëo√°n ng·∫Øn h·∫°n.`;
            
            let response;
            if (provider === 'claude') {
                response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': apiKey,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-3-5-sonnet-20241022',
                        max_tokens: 2000,
                        messages: [{ role: 'user', content: prompt }]
                    })
                });
                const data = await response.json();
                responseDiv.textContent = data.content[0].text;
            } else {
                response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4',
                        messages: [{ role: 'user', content: prompt }]
                    })
                });
                const data = await response.json();
                responseDiv.textContent = data.choices[0].message.content;
            }
        } catch (error) {
            responseDiv.textContent = '‚ùå L·ªói: ' + error.message;
        }
    }

    // Start
    window.addEventListener('load', () => {
        console.log('üöÄ Kh·ªüi ƒë·ªông XAU/USD Analysis Tool V3');
        fetchAllSources();
        setInterval(fetchAllSources, 30000); // Update every 30s
    });
</script>
```

</body>
</html>
