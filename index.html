<!DOCTYPE html>

<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XAU/USD Professional Trading Analysis</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #F8F9FC;
            --bg-secondary: #FFFFFF;
            --bg-card: #FFFFFF;
            --accent-green: #10B981;
            --accent-red: #EF4444;
            --accent-blue: #3B82F6;
            --accent-amber: #F59E0B;
            --text-primary: #1E293B;
            --text-secondary: #64748B;
            --border-color: #E2E8F0;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
        }

```
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Outfit', sans-serif;
        background: linear-gradient(135deg, #F8F9FC 0%, #E8EAF2 100%);
        color: var(--text-primary);
        line-height: 1.6;
        min-height: 100vh;
        padding: 20px;
    }

    .container {
        max-width: 1600px;
        margin: 0 auto;
    }

    /* Header */
    .header {
        background: linear-gradient(135deg, #1E293B 0%, #334155 100%);
        border-radius: 20px;
        padding: 30px 40px;
        margin-bottom: 30px;
        box-shadow: var(--shadow-lg);
        position: relative;
        overflow: hidden;
    }

    .header::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 300px;
        height: 300px;
        background: radial-gradient(circle, rgba(251, 191, 36, 0.15) 0%, transparent 70%);
        border-radius: 50%;
        transform: translate(30%, -30%);
    }

    .header-content {
        position: relative;
        z-index: 1;
    }

    .header h1 {
        font-size: 42px;
        font-weight: 800;
        color: #FFFFFF;
        margin-bottom: 10px;
        letter-spacing: -1px;
    }

    .header-subtitle {
        font-size: 16px;
        color: #94A3B8;
        font-weight: 300;
    }

    /* Data Source Control */
    .data-control {
        background: linear-gradient(135deg, #FFFFFF 0%, #EFF6FF 100%);
        border-radius: 16px;
        padding: 20px 30px;
        margin-bottom: 25px;
        border: 2px solid var(--accent-blue);
        display: flex;
        align-items: center;
        gap: 15px;
        flex-wrap: wrap;
    }

    .data-control-label {
        font-weight: 700;
        color: var(--text-primary);
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .data-input {
        flex: 1;
        min-width: 300px;
        padding: 12px 18px;
        border: 2px solid var(--border-color);
        border-radius: 10px;
        font-family: 'JetBrains Mono', monospace;
        font-size: 14px;
        transition: all 0.3s ease;
    }

    .data-input:focus {
        outline: none;
        border-color: var(--accent-blue);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 10px;
        font-weight: 700;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--accent-blue), #2563EB);
        color: white;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
    }

    .btn-secondary {
        background: var(--bg-primary);
        color: var(--text-primary);
    }

    .btn-secondary:hover {
        background: #E8EAF2;
    }

    /* Live Price Display */
    .price-hero {
        background: linear-gradient(135deg, #FFFFFF 0%, #F8FAFC 100%);
        border-radius: 20px;
        padding: 40px;
        margin-bottom: 30px;
        box-shadow: var(--shadow-lg);
        border: 1px solid var(--border-color);
    }

    .price-main {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 25px;
    }

    .price-label {
        font-size: 18px;
        color: var(--text-secondary);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 2px;
    }

    .price-value {
        font-family: 'JetBrains Mono', monospace;
        font-size: 56px;
        font-weight: 800;
        color: var(--text-primary);
        display: flex;
        align-items: baseline;
        gap: 12px;
    }

    .price-change {
        font-size: 24px;
        padding: 8px 16px;
        border-radius: 12px;
        font-weight: 600;
    }

    .price-change.positive {
        background: rgba(16, 185, 129, 0.1);
        color: var(--accent-green);
    }

    .price-change.negative {
        background: rgba(239, 68, 68, 0.1);
        color: var(--accent-red);
    }

    .price-stats {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
    }

    .stat-item {
        text-align: center;
        padding: 15px;
        background: var(--bg-primary);
        border-radius: 12px;
    }

    .stat-label {
        font-size: 13px;
        color: var(--text-secondary);
        margin-bottom: 5px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .stat-value {
        font-family: 'JetBrains Mono', monospace;
        font-size: 20px;
        font-weight: 700;
        color: var(--text-primary);
    }

    /* Grid Layout */
    .analysis-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
    }

    /* Cards */
    .card {
        background: var(--bg-card);
        border-radius: 20px;
        padding: 30px;
        box-shadow: var(--shadow-md);
        border: 1px solid var(--border-color);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
    }

    .card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 25px;
        padding-bottom: 20px;
        border-bottom: 2px solid var(--bg-primary);
    }

    .card-title {
        font-size: 22px;
        font-weight: 700;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .card-badge {
        font-size: 12px;
        padding: 6px 12px;
        border-radius: 8px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* Timeframe Analysis */
    .timeframe-grid {
        display: grid;
        gap: 15px;
    }

    .timeframe-item {
        background: var(--bg-primary);
        border-radius: 12px;
        padding: 20px;
        border-left: 4px solid transparent;
        transition: all 0.3s ease;
    }

    .timeframe-item:hover {
        background: #E8EAF2;
        transform: translateX(4px);
    }

    .timeframe-item.bullish {
        border-left-color: var(--accent-green);
    }

    .timeframe-item.bearish {
        border-left-color: var(--accent-red);
    }

    .timeframe-item.neutral {
        border-left-color: var(--accent-amber);
    }

    .timeframe-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
    }

    .timeframe-name {
        font-size: 16px;
        font-weight: 700;
        color: var(--text-primary);
    }

    .timeframe-signal {
        font-size: 14px;
        font-weight: 600;
        padding: 4px 12px;
        border-radius: 6px;
    }

    .timeframe-signal.buy {
        background: rgba(16, 185, 129, 0.15);
        color: var(--accent-green);
    }

    .timeframe-signal.sell {
        background: rgba(239, 68, 68, 0.15);
        color: var(--accent-red);
    }

    .timeframe-signal.hold {
        background: rgba(245, 158, 11, 0.15);
        color: var(--accent-amber);
    }

    .timeframe-details {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        font-size: 13px;
        color: var(--text-secondary);
    }

    .detail-item {
        display: flex;
        justify-content: space-between;
    }

    .detail-value {
        font-family: 'JetBrains Mono', monospace;
        font-weight: 600;
        color: var(--text-primary);
    }

    /* Trading Signals */
    .signal-card {
        background: linear-gradient(135deg, #FFFFFF 0%, #F0FDF4 100%);
        border: 2px solid var(--accent-green);
        border-radius: 16px;
        padding: 25px;
        margin-bottom: 20px;
        position: relative;
        overflow: hidden;
    }

    .signal-card.sell-signal {
        background: linear-gradient(135deg, #FFFFFF 0%, #FEF2F2 100%);
        border-color: var(--accent-red);
    }

    .signal-card::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200px;
        height: 200px;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
        border-radius: 50%;
    }

    .signal-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
    }

    .signal-type {
        font-size: 28px;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 2px;
    }

    .signal-type.buy {
        color: var(--accent-green);
    }

    .signal-type.sell {
        color: var(--accent-red);
    }

    .signal-confidence {
        font-size: 14px;
        padding: 6px 14px;
        border-radius: 8px;
        font-weight: 600;
        background: rgba(0, 0, 0, 0.05);
    }

    .signal-details {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
    }

    .signal-detail {
        background: rgba(255, 255, 255, 0.7);
        padding: 15px;
        border-radius: 10px;
        backdrop-filter: blur(10px);
    }

    .signal-detail-label {
        font-size: 12px;
        color: var(--text-secondary);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 5px;
    }

    .signal-detail-value {
        font-family: 'JetBrains Mono', monospace;
        font-size: 20px;
        font-weight: 700;
        color: var(--text-primary);
    }

    /* Technical Indicators */
    .indicator-list {
        display: grid;
        gap: 12px;
    }

    .indicator-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        background: var(--bg-primary);
        border-radius: 10px;
        transition: all 0.2s ease;
    }

    .indicator-item:hover {
        background: #E8EAF2;
        transform: translateX(4px);
    }

    .indicator-name {
        font-weight: 600;
        color: var(--text-primary);
    }

    .indicator-value {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .indicator-number {
        font-family: 'JetBrains Mono', monospace;
        font-weight: 600;
    }

    .indicator-status {
        font-size: 12px;
        padding: 4px 10px;
        border-radius: 6px;
        font-weight: 600;
    }

    /* AI Analysis Section */
    .ai-section {
        background: linear-gradient(135deg, #FFFFFF 0%, #EFF6FF 100%);
        border-radius: 20px;
        padding: 35px;
        margin-top: 30px;
        box-shadow: var(--shadow-lg);
        border: 2px solid var(--accent-blue);
    }

    .ai-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 25px;
    }

    .ai-icon {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, var(--accent-blue), #2563EB);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
    }

    .ai-title {
        font-size: 24px;
        font-weight: 700;
        color: var(--text-primary);
    }

    .api-input-group {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 15px;
        margin-bottom: 20px;
    }

    .api-input {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .api-input label {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .api-input input {
        padding: 14px 18px;
        border: 2px solid var(--border-color);
        border-radius: 12px;
        font-family: 'JetBrains Mono', monospace;
        font-size: 14px;
        transition: all 0.3s ease;
    }

    .api-input input:focus {
        outline: none;
        border-color: var(--accent-blue);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .api-select {
        padding: 14px 18px;
        border: 2px solid var(--border-color);
        border-radius: 12px;
        font-weight: 600;
        background: white;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .api-select:focus {
        outline: none;
        border-color: var(--accent-blue);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .ai-response {
        background: white;
        border-radius: 12px;
        padding: 25px;
        margin-top: 20px;
        border: 1px solid var(--border-color);
        white-space: pre-wrap;
        font-size: 15px;
        line-height: 1.7;
        color: var(--text-primary);
        max-height: 500px;
        overflow-y: auto;
    }

    .ai-response:empty {
        display: none;
    }

    /* Loading Animation */
    .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* Status Indicator */
    .status-indicator {
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-right: 8px;
        animation: pulse 2s ease-in-out infinite;
    }

    .status-indicator.active {
        background: var(--accent-green);
        box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
    }

    .status-indicator.simulated {
        background: var(--accent-amber);
        box-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }

    /* Info Banner */
    .info-banner {
        background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
        border: 2px solid var(--accent-amber);
        border-radius: 12px;
        padding: 15px 20px;
        margin-bottom: 25px;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .info-banner-icon {
        font-size: 24px;
    }

    .info-banner-text {
        font-size: 14px;
        color: #92400E;
        font-weight: 600;
    }

    /* Responsive */
    @media (max-width: 1200px) {
        .analysis-grid {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 768px) {
        .price-value {
            font-size: 40px;
        }
        
        .price-stats {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .signal-details {
            grid-template-columns: 1fr;
        }
        
        .api-input-group {
            grid-template-columns: 1fr;
        }

        .data-control {
            flex-direction: column;
            align-items: stretch;
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <h1>XAU/USD Trading Analysis</h1>
                <p class="header-subtitle">Real-time Gold Market Analysis ‚Ä¢ Multi-Timeframe Technical Signals ‚Ä¢ AI-Powered Insights</p>
            </div>
        </div>

```
    <!-- Info Banner -->
    <div class="info-banner">
        <span class="info-banner-icon">üí°</span>
        <div class="info-banner-text">
            ƒê·ªÉ c√≥ gi√° real-time 100%, paste URL API Twelve Data v√†o √¥ b√™n d∆∞·ªõi. V√≠ d·ª•: https://api.twelvedata.com/quote?symbol=XAU/USD&apikey=YOUR_KEY
        </div>
    </div>

    <!-- Data Source Control -->
    <div class="data-control">
        <span class="data-control-label">üì° Data Source:</span>
        <input type="text" id="apiUrlInput" class="data-input" placeholder="Paste Twelve Data API URL ho·∫∑c ƒë·ªÉ tr·ªëng ƒë·ªÉ d√πng simulation">
        <button class="btn btn-primary" onclick="loadFromAPI()">Load Real Data</button>
        <button class="btn btn-secondary" onclick="startSimulation()">Use Simulation</button>
    </div>

    <!-- Live Price Hero -->
    <div class="price-hero">
        <div class="price-main">
            <div>
                <div class="price-label">
                    <span class="status-indicator simulated" id="statusIndicator"></span>
                    <span id="dataMode">Simulated Price</span>
                </div>
                <div class="price-value">
                    $<span id="currentPrice">2650.00</span>
                    <span id="priceChange" class="price-change positive">+2.50 (+0.09%)</span>
                </div>
            </div>
        </div>
        <div class="price-stats">
            <div class="stat-item">
                <div class="stat-label">Bid</div>
                <div class="stat-value" id="bidPrice">$2649.75</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Ask</div>
                <div class="stat-value" id="askPrice">$2650.25</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">High (24h)</div>
                <div class="stat-value" id="highPrice">$2663.15</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Low (24h)</div>
                <div class="stat-value" id="lowPrice">$2636.80</div>
            </div>
        </div>
    </div>

    <!-- Main Analysis Grid -->
    <div class="analysis-grid">
        <!-- Multi-Timeframe Analysis -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    üìä Multi-Timeframe Analysis
                </div>
            </div>
            <div class="timeframe-grid" id="timeframeAnalysis">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

        <!-- Technical Indicators -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    üîç Technical Indicators
                </div>
            </div>
            <div class="indicator-list" id="technicalIndicators">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Trading Signals -->
    <div class="card">
        <div class="card-header">
            <div class="card-title">
                ‚ö° Trading Signals
            </div>
            <div class="card-badge" style="background: rgba(59, 130, 246, 0.1); color: var(--accent-blue);">
                Updated Real-Time
            </div>
        </div>
        <div id="tradingSignals">
            <!-- Will be populated by JavaScript -->
        </div>
    </div>

    <!-- AI Analysis Section -->
    <div class="ai-section">
        <div class="ai-header">
            <div class="ai-icon">ü§ñ</div>
            <div>
                <div class="ai-title">AI-Powered Deep Analysis</div>
                <p style="color: var(--text-secondary); margin-top: 5px;">Get advanced insights using Claude AI or OpenAI</p>
            </div>
        </div>
        
        <div class="api-input-group">
            <div class="api-input">
                <label for="aiProvider">AI Provider</label>
                <select id="aiProvider" class="api-select">
                    <option value="claude">Claude (Anthropic)</option>
                    <option value="openai">OpenAI GPT-4</option>
                </select>
            </div>
            <div class="api-input">
                <label for="apiKey">API Key</label>
                <input type="password" id="apiKey" placeholder="Enter your API key..." />
            </div>
            <button class="btn btn-primary" onclick="analyzeWithAI()" id="analyzeBtn">
                Analyze with AI
            </button>
        </div>
        
        <div id="aiResponse" class="ai-response"></div>
    </div>
</div>

<script>
    // Global variables
    let marketData = {
        price: 2650,
        bid: 2649.75,
        ask: 2650.25,
        high: 2663.15,
        low: 2636.80,
        open: 2647.50,
        previousClose: 2647.50,
        change: 2.50,
        changePercent: 0.09,
        mode: 'simulated' // 'simulated' or 'real'
    };

    let updateInterval;
    let priceHistory = [];

    // Simulate realistic price movement
    function simulatePrice() {
        // Brownian motion with mean reversion
        const volatility = 0.0003; // 0.03% per tick
        const meanReversion = 0.0001;
        const targetPrice = 2650;
        
        // Random walk
        const randomChange = (Math.random() - 0.5) * marketData.price * volatility * 2;
        
        // Mean reversion component
        const meanReversionForce = (targetPrice - marketData.price) * meanReversion;
        
        // Update price
        marketData.price += randomChange + meanReversionForce;
        
        // Update bid/ask
        const spread = 0.5;
        marketData.bid = marketData.price - spread / 2;
        marketData.ask = marketData.price + spread / 2;
        
        // Update high/low
        if (marketData.price > marketData.high) {
            marketData.high = marketData.price;
        }
        if (marketData.price < marketData.low) {
            marketData.low = marketData.price;
        }
        
        // Calculate change
        marketData.change = marketData.price - marketData.previousClose;
        marketData.changePercent = (marketData.change / marketData.previousClose) * 100;
        
        // Store history
        priceHistory.push({
            time: new Date(),
            price: marketData.price
        });
        
        // Keep only last 100 ticks
        if (priceHistory.length > 100) {
            priceHistory.shift();
        }
        
        updatePriceDisplay();
    }

    // Load data from external API
    async function loadFromAPI() {
        const apiUrl = document.getElementById('apiUrlInput').value.trim();
        
        if (!apiUrl) {
            alert('Vui l√≤ng nh·∫≠p API URL');
            return;
        }

        try {
            const response = await fetch(apiUrl);
            const data = await response.json();
            
            if (data.close) {
                marketData.price = parseFloat(data.close);
                marketData.open = parseFloat(data.open);
                marketData.high = parseFloat(data.high);
                marketData.low = parseFloat(data.low);
                marketData.previousClose = parseFloat(data.previous_close);
                
                const spread = 0.5;
                marketData.bid = marketData.price - spread / 2;
                marketData.ask = marketData.price + spread / 2;
                
                marketData.change = marketData.price - marketData.previousClose;
                marketData.changePercent = (marketData.change / marketData.previousClose) * 100;
                
                marketData.mode = 'real';
                
                updatePriceDisplay();
                updateAnalysis();
                
                // Update status
                document.getElementById('dataMode').textContent = 'Live Real Data';
                document.getElementById('statusIndicator').className = 'status-indicator active';
                
                alert('‚úì ƒê√£ load gi√° th·ª±c t·ª´ API!');
            } else {
                throw new Error('Invalid API response');
            }
        } catch (error) {
            alert('L·ªói khi load API: ' + error.message + '\n\nG·ª£i √Ω: Th·ª≠ m·ªü link API tr√™n browser ri√™ng, copy k·∫øt qu·∫£ JSON v√† paste v√†o ƒë√¢y.');
            console.error('API Error:', error);
        }
    }

    // Start simulation mode
    function startSimulation() {
        marketData.mode = 'simulated';
        
        // Reset to base values
        marketData.price = 2650 + (Math.random() - 0.5) * 20;
        marketData.previousClose = marketData.price * 0.998;
        marketData.high = marketData.price * 1.005;
        marketData.low = marketData.price * 0.995;
        
        updatePriceDisplay();
        updateAnalysis();
        
        // Update status
        document.getElementById('dataMode').textContent = 'Simulated Price (Realistic)';
        document.getElementById('statusIndicator').className = 'status-indicator simulated';
        
        // Clear existing interval
        if (updateInterval) {
            clearInterval(updateInterval);
        }
        
        // Start simulation updates every 3 seconds
        updateInterval = setInterval(() => {
            simulatePrice();
            updateAnalysis();
        }, 3000);
    }

    // Update price display
    function updatePriceDisplay() {
        document.getElementById('currentPrice').textContent = marketData.price.toFixed(2);
        document.getElementById('bidPrice').textContent = '$' + marketData.bid.toFixed(2);
        document.getElementById('askPrice').textContent = '$' + marketData.ask.toFixed(2);
        document.getElementById('highPrice').textContent = '$' + marketData.high.toFixed(2);
        document.getElementById('lowPrice').textContent = '$' + marketData.low.toFixed(2);
        
        const changeEl = document.getElementById('priceChange');
        const changeText = (marketData.change >= 0 ? '+' : '') + marketData.change.toFixed(2) + 
                         ' (' + (marketData.changePercent >= 0 ? '+' : '') + marketData.changePercent.toFixed(2) + '%)';
        changeEl.textContent = changeText;
        changeEl.className = 'price-change ' + (marketData.change >= 0 ? 'positive' : 'negative');
    }

    // Calculate RSI
    function calculateRSI(period = 14) {
        if (priceHistory.length < 2) {
            return 50;
        }
        
        let gains = 0;
        let losses = 0;
        
        for (let i = Math.max(0, priceHistory.length - period); i < priceHistory.length; i++) {
            if (i === 0) continue;
            const change = priceHistory[i].price - priceHistory[i-1].price;
            if (change > 0) {
                gains += change;
            } else {
                losses += Math.abs(change);
            }
        }
        
        const avgGain = gains / period;
        const avgLoss = losses / period;
        
        if (avgLoss === 0) return 100;
        
        const rs = avgGain / avgLoss;
        const rsi = 100 - (100 / (1 + rs));
        
        return rsi;
    }

    // Calculate MACD
    function calculateMACD() {
        const trend = marketData.changePercent;
        return {
            value: trend * 0.5,
            signal: trend * 0.4,
            histogram: trend * 0.1
        };
    }

    // Calculate Bollinger Bands
    function calculateBollingerBands() {
        const middle = marketData.price;
        const deviation = marketData.price * 0.015;
        
        return {
            upper: middle + (2 * deviation),
            middle: middle,
            lower: middle - (2 * deviation)
        };
    }

    // Generate multi-timeframe analysis
    function generateTimeframeAnalysis() {
        const timeframes = [
            { name: 'M5 (Scalping)', period: '5min', weight: 1 },
            { name: 'M15 (Short-term)', period: '15min', weight: 1.5 },
            { name: 'H1 (Intraday)', period: '1h', weight: 2 },
            { name: 'H4 (Swing)', period: '4h', weight: 2.5 },
            { name: 'D1 (Daily)', period: '1day', weight: 3 }
        ];

        const container = document.getElementById('timeframeAnalysis');
        container.innerHTML = '';

        timeframes.forEach((tf, index) => {
            const rsi = calculateRSI();
            const macd = calculateMACD();
            const pricePosition = (marketData.price - marketData.low) / (marketData.high - marketData.low);
            
            let score = 0;
            score += (rsi > 50 ? 1 : -1) * tf.weight;
            score += (macd.value > 0 ? 1 : -1) * tf.weight;
            score += (pricePosition > 0.5 ? 1 : -1) * tf.weight;
            
            let trend, signal, entry, tp, sl;
            
            if (score > 2) {
                trend = 'bullish';
                signal = 'buy';
                entry = marketData.price;
                tp = entry + (entry * 0.005 * (index + 1));
                sl = entry - (entry * 0.003 * (index + 1));
            } else if (score < -2) {
                trend = 'bearish';
                signal = 'sell';
                entry = marketData.price;
                tp = entry - (entry * 0.005 * (index + 1));
                sl = entry + (entry * 0.003 * (index + 1));
            } else {
                trend = 'neutral';
                signal = 'hold';
                entry = marketData.price;
                tp = entry + (entry * 0.003);
                sl = entry - (entry * 0.003);
            }

            const html = `
                <div class="timeframe-item ${trend}">
                    <div class="timeframe-header">
                        <span class="timeframe-name">${tf.name}</span>
                        <span class="timeframe-signal ${signal}">${signal.toUpperCase()}</span>
                    </div>
                    <div class="timeframe-details">
                        <div class="detail-item">
                            <span>Entry:</span>
                            <span class="detail-value">$${entry.toFixed(2)}</span>
                        </div>
                        <div class="detail-item">
                            <span>TP:</span>
                            <span class="detail-value" style="color: var(--accent-green);">$${tp.toFixed(2)}</span>
                        </div>
                        <div class="detail-item">
                            <span>SL:</span>
                            <span class="detail-value" style="color: var(--accent-red);">$${sl.toFixed(2)}</span>
                        </div>
                        <div class="detail-item">
                            <span>R:R:</span>
                            <span class="detail-value">1:${(Math.abs(tp - entry) / Math.abs(entry - sl)).toFixed(2)}</span>
                        </div>
                    </div>
                </div>
            `;
            container.innerHTML += html;
        });
    }

    // Generate technical indicators display
    function generateTechnicalIndicators() {
        const rsi = calculateRSI();
        const macd = calculateMACD();
        const bb = calculateBollingerBands();
        
        const indicators = [
            {
                name: 'RSI (14)',
                value: rsi.toFixed(2),
                status: rsi > 70 ? 'Overbought' : rsi < 30 ? 'Oversold' : 'Neutral',
                color: rsi > 70 ? 'var(--accent-red)' : rsi < 30 ? 'var(--accent-green)' : 'var(--accent-amber)'
            },
            {
                name: 'MACD',
                value: macd.value.toFixed(4),
                status: macd.value > 0 ? 'Bullish' : 'Bearish',
                color: macd.value > 0 ? 'var(--accent-green)' : 'var(--accent-red)'
            },
            {
                name: 'BB Upper',
                value: '$' + bb.upper.toFixed(2),
                status: 'Resistance',
                color: 'var(--accent-red)'
            },
            {
                name: 'BB Lower',
                value: '$' + bb.lower.toFixed(2),
                status: 'Support',
                color: 'var(--accent-green)'
            },
            {
                name: 'Moving Average (20)',
                value: '$' + marketData.price.toFixed(2),
                status: marketData.changePercent > 0 ? 'Above' : 'Below',
                color: marketData.changePercent > 0 ? 'var(--accent-green)' : 'var(--accent-red)'
            },
            {
                name: 'Momentum',
                value: marketData.changePercent.toFixed(2) + '%',
                status: Math.abs(marketData.changePercent) > 0.5 ? 'Strong' : 'Weak',
                color: Math.abs(marketData.changePercent) > 0.5 ? 'var(--accent-blue)' : 'var(--accent-amber)'
            }
        ];

        const container = document.getElementById('technicalIndicators');
        container.innerHTML = indicators.map(ind => `
            <div class="indicator-item">
                <span class="indicator-name">${ind.name}</span>
                <div class="indicator-value">
                    <span class="indicator-number">${ind.value}</span>
                    <span class="indicator-status" style="background: ${ind.color}20; color: ${ind.color};">
                        ${ind.status}
                    </span>
                </div>
            </div>
        `).join('');
    }

    // Generate trading signals
    function generateTradingSignals() {
        const rsi = calculateRSI();
        const macd = calculateMACD();
        const container = document.getElementById('tradingSignals');
        
        let signalType = 'buy';
        let confidence = 'Medium';
        
        if (rsi < 30 && macd.value > 0) {
            signalType = 'buy';
            confidence = 'High';
        } else if (rsi > 70 && macd.value < 0) {
            signalType = 'sell';
            confidence = 'High';
        } else if (marketData.changePercent > 0.5) {
            signalType = 'buy';
            confidence = 'Medium';
        } else if (marketData.changePercent < -0.5) {
            signalType = 'sell';
            confidence = 'Medium';
        }

        const entry = marketData.price;
        const tp = signalType === 'buy' ? entry * 1.008 : entry * 0.992;
        const sl = signalType === 'buy' ? entry * 0.997 : entry * 1.003;
        const rr = Math.abs(tp - entry) / Math.abs(entry - sl);

        const html = `
            <div class="signal-card ${signalType === 'sell' ? 'sell-signal' : ''}">
                <div class="signal-header">
                    <div class="signal-type ${signalType}">${signalType} Signal</div>
                    <div class="signal-confidence">Confidence: ${confidence}</div>
                </div>
                <div class="signal-details">
                    <div class="signal-detail">
                        <div class="signal-detail-label">Entry Price</div>
                        <div class="signal-detail-value">$${entry.toFixed(2)}</div>
                    </div>
                    <div class="signal-detail">
                        <div class="signal-detail-label">Take Profit</div>
                        <div class="signal-detail-value" style="color: var(--accent-green);">$${tp.toFixed(2)}</div>
                    </div>
                    <div class="signal-detail">
                        <div class="signal-detail-label">Stop Loss</div>
                        <div class="signal-detail-value" style="color: var(--accent-red);">$${sl.toFixed(2)}</div>
                    </div>
                </div>
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0,0,0,0.1); color: var(--text-secondary); font-size: 14px;">
                    üí° Risk/Reward Ratio: 1:${rr.toFixed(2)} | Recommended position size: 1-2% of capital
                </div>
            </div>
        `;
        
        container.innerHTML = html;
    }

    // AI Analysis Function
    async function analyzeWithAI() {
        const apiKey = document.getElementById('apiKey').value;
        const provider = document.getElementById('aiProvider').value;
        const responseDiv = document.getElementById('aiResponse');
        const button = document.getElementById('analyzeBtn');

        if (!apiKey) {
            alert('Please enter your API key');
            return;
        }

        const marketDataJSON = {
            symbol: 'XAU/USD',
            timestamp: new Date().toISOString(),
            mode: marketData.mode,
            price: marketData.price,
            bid: marketData.bid,
            ask: marketData.ask,
            high24h: marketData.high,
            low24h: marketData.low,
            change: marketData.change,
            changePercent: marketData.changePercent,
            technicalIndicators: {
                rsi: calculateRSI(),
                macd: calculateMACD(),
                bollingerBands: calculateBollingerBands()
            }
        };

        button.disabled = true;
        button.innerHTML = '<span class="loading"></span> Analyzing...';
        responseDiv.textContent = 'Connecting to AI...';

        try {
            let response;
            
            if (provider === 'claude') {
                response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': apiKey,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1024,
                        messages: [{
                            role: 'user',
                            content: `Analyze this XAU/USD market data and provide trading insights:
```

${JSON.stringify(marketDataJSON, null, 2)}

Please provide:

1. Market sentiment analysis
1. Key support and resistance levels
1. Trading recommendations (entry, TP, SL)
1. Risk assessment
1. Short-term and medium-term outlook

Keep the analysis concise and actionable for traders.`
}]
})
});

```
                const data = await response.json();
                if (data.content && data.content[0]) {
                    responseDiv.textContent = data.content[0].text;
                } else {
                    throw new Error(data.error?.message || 'Invalid response from Claude');
                }

            } else {
                response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4',
                        messages: [{
                            role: 'user',
                            content: `Analyze this XAU/USD market data and provide trading insights:
```

${JSON.stringify(marketDataJSON, null, 2)}

Please provide:

1. Market sentiment analysis
1. Key support and resistance levels
1. Trading recommendations (entry, TP, SL)
1. Risk assessment
1. Short-term and medium-term outlook

Keep the analysis concise and actionable for traders.`
}],
max_tokens: 1024
})
});

```
                const data = await response.json();
                if (data.choices && data.choices[0]) {
                    responseDiv.textContent = data.choices[0].message.content;
                } else {
                    throw new Error(data.error?.message || 'Invalid response from OpenAI');
                }
            }

        } catch (error) {
            responseDiv.textContent = `Error: ${error.message}`;
            console.error('AI Analysis error:', error);
        } finally {
            button.disabled = false;
            button.innerHTML = 'Analyze with AI';
        }
    }

    // Update all analysis
    function updateAnalysis() {
        generateTimeframeAnalysis();
        generateTechnicalIndicators();
        generateTradingSignals();
    }

    // Initialize
    function initialize() {
        updatePriceDisplay();
        updateAnalysis();
        startSimulation();
    }

    // Start the application
    initialize();
</script>
```

</body>
</html>
