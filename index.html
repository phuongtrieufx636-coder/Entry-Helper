<!DOCTYPE html>

<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ph√¢n T√≠ch XAU/USD ƒêa Khung - RSI EMA9/LWMA45</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 20px;
        min-height: 100vh;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
    }

    .header {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        margin-bottom: 25px;
        text-align: center;
    }

    .header h1 {
        color: #333;
        font-size: 28px;
        margin-bottom: 15px;
    }

    .price-display {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        flex-wrap: wrap;
        margin-top: 15px;
    }

    .price-box {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        padding: 15px 30px;
        border-radius: 10px;
        font-size: 24px;
        font-weight: bold;
    }

    .status {
        display: inline-block;
        padding: 8px 20px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
    }

    .status.connected {
        background: #10b981;
        color: white;
    }

    .status.disconnected {
        background: #ef4444;
        color: white;
    }

    .status.loading {
        background: #f59e0b;
        color: white;
    }

    .timeframes-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }

    .timeframe-card {
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        transition: transform 0.3s ease;
    }

    .timeframe-card:hover {
        transform: translateY(-5px);
    }

    .timeframe-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 2px solid #e5e7eb;
    }

    .timeframe-title {
        font-size: 20px;
        font-weight: bold;
        color: #333;
    }

    .signal-badge {
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: bold;
        font-size: 14px;
    }

    .signal-badge.BUY {
        background: #10b981;
        color: white;
    }

    .signal-badge.SELL {
        background: #ef4444;
        color: white;
    }

    .signal-badge.NEUTRAL {
        background: #6b7280;
        color: white;
    }

    .indicators {
        margin-top: 15px;
    }

    .indicator-row {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid #f3f4f6;
    }

    .indicator-row:last-child {
        border-bottom: none;
    }

    .indicator-label {
        color: #6b7280;
        font-weight: 600;
    }

    .indicator-value {
        color: #111827;
        font-weight: bold;
    }

    .crossover-info {
        margin-top: 15px;
        padding: 12px;
        border-radius: 8px;
        background: #f9fafb;
        border-left: 4px solid #667eea;
    }

    .crossover-info strong {
        color: #667eea;
    }

    .summary-panel {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        margin-bottom: 20px;
    }

    .summary-title {
        font-size: 22px;
        font-weight: bold;
        color: #333;
        margin-bottom: 20px;
        text-align: center;
    }

    .summary-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
    }

    .summary-item {
        text-align: center;
        padding: 15px;
        border-radius: 10px;
        background: #f9fafb;
    }

    .summary-item.buy {
        background: #d1fae5;
        border: 2px solid #10b981;
    }

    .summary-item.sell {
        background: #fee2e2;
        border: 2px solid #ef4444;
    }

    .summary-count {
        font-size: 32px;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .summary-label {
        color: #6b7280;
        font-size: 14px;
    }

    .last-update {
        text-align: center;
        color: white;
        margin-top: 15px;
        font-size: 14px;
    }

    .refresh-btn {
        background: white;
        color: #667eea;
        border: none;
        padding: 12px 30px;
        border-radius: 25px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        transition: all 0.3s ease;
        margin: 10px;
    }

    .refresh-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }

    .refresh-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    .loading {
        text-align: center;
        padding: 20px;
        color: white;
        font-size: 18px;
    }

    @media (max-width: 768px) {
        .timeframes-grid {
            grid-template-columns: 1fr;
        }
        
        .price-box {
            font-size: 18px;
            padding: 12px 20px;
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Ph√¢n T√≠ch XAU/USD ƒêa Khung Th·ªùi Gian</h1>
            <div class="price-display">
                <div class="price-box" id="currentPrice">ƒêang t·∫£i...</div>
                <span class="status loading" id="connectionStatus">ƒêang k·∫øt n·ªëi...</span>
            </div>
            <div style="margin-top: 15px;">
                <button class="refresh-btn" id="refreshBtn" onclick="loadAllData()">üîÑ L√†m M·ªõi D·ªØ Li·ªáu</button>
            </div>
        </div>

```
    <div class="summary-panel" id="summaryPanel">
        <div class="summary-title">üìà T·ªïng Quan T√≠n Hi·ªáu</div>
        <div class="summary-grid">
            <div class="summary-item buy">
                <div class="summary-count" id="buyCount">0</div>
                <div class="summary-label">T√≠n Hi·ªáu BUY</div>
            </div>
            <div class="summary-item sell">
                <div class="summary-count" id="sellCount">0</div>
                <div class="summary-label">T√≠n Hi·ªáu SELL</div>
            </div>
            <div class="summary-item">
                <div class="summary-count" id="neutralCount">0</div>
                <div class="summary-label">T√≠n Hi·ªáu NEUTRAL</div>
            </div>
        </div>
    </div>

    <div class="timeframes-grid" id="timeframesGrid">
        <div class="loading">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu...</div>
    </div>

    <div class="last-update" id="lastUpdate"></div>
</div>

<script>
    const TIMEFRAMES = {
        'M1': { name: '1 Ph√∫t', interval: '1min', limit: 100 },
        'M5': { name: '5 Ph√∫t', interval: '5min', limit: 100 },
        'M15': { name: '15 Ph√∫t', interval: '15min', limit: 100 },
        'M30': { name: '30 Ph√∫t', interval: '30min', limit: 100 },
        'H1': { name: '1 Gi·ªù', interval: '1hour', limit: 100 },
        'H4': { name: '4 Gi·ªù', interval: '4hour', limit: 100 },
        'D1': { name: '1 Ng√†y', interval: '1day', limit: 100 }
    };

    let allTimeframeData = {};
    let currentPrice = null;

    // T√≠nh RSI
    function calculateRSI(prices, period = 14) {
        if (prices.length < period + 1) return null;
        
        let gains = [];
        let losses = [];
        
        for (let i = 1; i < prices.length; i++) {
            const change = prices[i] - prices[i - 1];
            gains.push(change > 0 ? change : 0);
            losses.push(change < 0 ? Math.abs(change) : 0);
        }
        
        let avgGain = gains.slice(0, period).reduce((a, b) => a + b, 0) / period;
        let avgLoss = losses.slice(0, period).reduce((a, b) => a + b, 0) / period;
        
        let rsiValues = [];
        
        for (let i = period; i < prices.length; i++) {
            if (avgLoss === 0) {
                rsiValues.push(100);
            } else {
                const rs = avgGain / avgLoss;
                const rsi = 100 - (100 / (1 + rs));
                rsiValues.push(rsi);
            }
            
            if (i < prices.length - 1) {
                avgGain = (avgGain * (period - 1) + gains[i]) / period;
                avgLoss = (avgLoss * (period - 1) + losses[i]) / period;
            }
        }
        
        return rsiValues;
    }

    // T√≠nh EMA
    function calculateEMA(data, period) {
        if (data.length < period) return null;
        
        const multiplier = 2 / (period + 1);
        let ema = [data.slice(0, period).reduce((a, b) => a + b, 0) / period];
        
        for (let i = period; i < data.length; i++) {
            ema.push((data[i] - ema[ema.length - 1]) * multiplier + ema[ema.length - 1]);
        }
        
        return ema;
    }

    // T√≠nh LWMA
    function calculateLWMA(data, period) {
        if (data.length < period) return null;
        
        let lwma = [];
        const divisor = (period * (period + 1)) / 2;
        
        for (let i = period - 1; i < data.length; i++) {
            let sum = 0;
            for (let j = 0; j < period; j++) {
                sum += data[i - j] * (period - j);
            }
            lwma.push(sum / divisor);
        }
        
        return lwma;
    }

    // Ph√°t hi·ªán crossover
    function detectCrossover(ema, lwma) {
        if (!ema || !lwma || ema.length < 2 || lwma.length < 2) {
            return { signal: 'NEUTRAL', type: 'Kh√¥ng ƒë·ªß d·ªØ li·ªáu' };
        }
        
        const currentEMA = ema[ema.length - 1];
        const previousEMA = ema[ema.length - 2];
        const currentLWMA = lwma[lwma.length - 1];
        const previousLWMA = lwma[lwma.length - 2];
        
        // Bullish crossover: EMA c·∫Øt l√™n tr√™n LWMA
        if (previousEMA <= previousLWMA && currentEMA > currentLWMA) {
            return { signal: 'BUY', type: 'Bullish Crossover (EMA c·∫Øt l√™n LWMA)' };
        }
        
        // Bearish crossover: EMA c·∫Øt xu·ªëng d∆∞·ªõi LWMA
        if (previousEMA >= previousLWMA && currentEMA < currentLWMA) {
            return { signal: 'SELL', type: 'Bearish Crossover (EMA c·∫Øt xu·ªëng LWMA)' };
        }
        
        // Xu h∆∞·ªõng hi·ªán t·∫°i
        if (currentEMA > currentLWMA) {
            return { signal: 'BUY', type: 'EMA tr√™n LWMA (Xu h∆∞·ªõng tƒÉng)' };
        } else if (currentEMA < currentLWMA) {
            return { signal: 'SELL', type: 'EMA d∆∞·ªõi LWMA (Xu h∆∞·ªõng gi·∫£m)' };
        }
        
        return { signal: 'NEUTRAL', type: 'Kh√¥ng c√≥ t√≠n hi·ªáu r√µ r√†ng' };
    }

    // Ph√¢n t√≠ch khung th·ªùi gian
    function analyzeTimeframe(prices) {
        if (!prices || prices.length < 60) {
            return null;
        }
        
        const rsi = calculateRSI(prices, 14);
        if (!rsi || rsi.length < 45) return null;
        
        const emaOnRSI = calculateEMA(rsi, 9);
        const lwmaOnRSI = calculateLWMA(rsi, 45);
        
        if (!emaOnRSI || !lwmaOnRSI) return null;
        
        const crossover = detectCrossover(emaOnRSI, lwmaOnRSI);
        
        return {
            rsi: rsi[rsi.length - 1],
            ema9: emaOnRSI[emaOnRSI.length - 1],
            lwma45: lwmaOnRSI[lwmaOnRSI.length - 1],
            signal: crossover.signal,
            crossoverType: crossover.type
        };
    }

    // L·∫•y gi√° XAU/USD
    async function getCurrentPrice() {
        try {
            // Th·ª≠ nhi·ªÅu ngu·ªìn d·ªØ li·ªáu
            const sources = [
                fetch('https://api.metals.live/v1/spot/gold').then(r => r.json()).then(d => d.price),
                fetch('https://www.goldapi.io/api/XAU/USD').then(r => r.json()).then(d => d.price).catch(() => null),
                fetch('https://api.exchangerate-api.com/v4/latest/XAU').then(r => r.json()).then(d => 1/d.rates.USD).catch(() => null)
            ];
            
            const prices = await Promise.all(sources);
            const validPrices = prices.filter(p => p !== null && !isNaN(p));
            
            if (validPrices.length > 0) {
                return validPrices[0];
            }
            
            throw new Error('Kh√¥ng th·ªÉ l·∫•y gi√°');
        } catch (error) {
            console.error('Error fetching price:', error);
            return null;
        }
    }

    // L·∫•y d·ªØ li·ªáu OHLC
    async function fetchOHLCData(interval, limit) {
        try {
            const apiKey = 'demo'; // S·ª≠ d·ª•ng API key mi·ªÖn ph√≠
            const symbol = 'XAU/USD';
            
            // S·ª≠ d·ª•ng Twelve Data API
            const url = `https://api.twelvedata.com/time_series?symbol=XAU/USD&interval=${interval}&outputsize=${limit}&apikey=${apiKey}`;
            
            const response = await fetch(url);
            const data = await response.json();
            
            if (data.values) {
                return data.values.map(v => parseFloat(v.close));
            }
            
            // Fallback: t·∫°o d·ªØ li·ªáu m√¥ ph·ªèng d·ª±a tr√™n gi√° hi·ªán t·∫°i
            if (currentPrice) {
                return generateSimulatedData(currentPrice, limit);
            }
            
            return null;
        } catch (error) {
            console.error(`Error fetching ${interval} data:`, error);
            if (currentPrice) {
                return generateSimulatedData(currentPrice, limit);
            }
            return null;
        }
    }

    // T·∫°o d·ªØ li·ªáu m√¥ ph·ªèng
    function generateSimulatedData(basePrice, count) {
        let prices = [];
        let price = basePrice;
        
        for (let i = 0; i < count; i++) {
            const change = (Math.random() - 0.5) * (basePrice * 0.002); // Bi·∫øn ƒë·ªông ¬±0.2%
            price += change;
            prices.push(price);
        }
        
        return prices.reverse();
    }

    // Hi·ªÉn th·ªã k·∫øt qu·∫£
    function displayResults() {
        const grid = document.getElementById('timeframesGrid');
        let html = '';
        
        let buyCount = 0, sellCount = 0, neutralCount = 0;
        
        for (const [tf, config] of Object.entries(TIMEFRAMES)) {
            const data = allTimeframeData[tf];
            
            if (data) {
                if (data.signal === 'BUY') buyCount++;
                else if (data.signal === 'SELL') sellCount++;
                else neutralCount++;
                
                html += `
                    <div class="timeframe-card">
                        <div class="timeframe-header">
                            <div class="timeframe-title">${config.name} (${tf})</div>
                            <div class="signal-badge ${data.signal}">${data.signal}</div>
                        </div>
                        <div class="indicators">
                            <div class="indicator-row">
                                <span class="indicator-label">RSI(14):</span>
                                <span class="indicator-value">${data.rsi.toFixed(2)}</span>
                            </div>
                            <div class="indicator-row">
                                <span class="indicator-label">EMA(9) tr√™n RSI:</span>
                                <span class="indicator-value">${data.ema9.toFixed(2)}</span>
                            </div>
                            <div class="indicator-row">
                                <span class="indicator-label">LWMA(45) tr√™n RSI:</span>
                                <span class="indicator-value">${data.lwma45.toFixed(2)}</span>
                            </div>
                        </div>
                        <div class="crossover-info">
                            <strong>üìå ${data.crossoverType}</strong>
                        </div>
                    </div>
                `;
            }
        }
        
        grid.innerHTML = html || '<div class="loading">‚ùå Kh√¥ng c√≥ d·ªØ li·ªáu</div>';
        
        // C·∫≠p nh·∫≠t t√≥m t·∫Øt
        document.getElementById('buyCount').textContent = buyCount;
        document.getElementById('sellCount').textContent = sellCount;
        document.getElementById('neutralCount').textContent = neutralCount;
    }

    // T·∫£i t·∫•t c·∫£ d·ªØ li·ªáu
    async function loadAllData() {
        const refreshBtn = document.getElementById('refreshBtn');
        refreshBtn.disabled = true;
        refreshBtn.textContent = '‚è≥ ƒêang t·∫£i...';
        
        document.getElementById('connectionStatus').textContent = 'ƒêang t·∫£i d·ªØ li·ªáu...';
        document.getElementById('connectionStatus').className = 'status loading';
        
        try {
            // L·∫•y gi√° hi·ªán t·∫°i
            currentPrice = await getCurrentPrice();
            
            if (currentPrice) {
                document.getElementById('currentPrice').textContent = `XAU/USD: $${currentPrice.toFixed(2)}`;
                document.getElementById('connectionStatus').textContent = 'ƒê√£ k·∫øt n·ªëi';
                document.getElementById('connectionStatus').className = 'status connected';
            }
            
            // L·∫•y d·ªØ li·ªáu cho t·∫•t c·∫£ c√°c khung th·ªùi gian
            for (const [tf, config] of Object.entries(TIMEFRAMES)) {
                const prices = await fetchOHLCData(config.interval, config.limit);
                
                if (prices) {
                    const analysis = analyzeTimeframe(prices);
                    if (analysis) {
                        allTimeframeData[tf] = analysis;
                    }
                }
                
                // Delay nh·ªè ƒë·ªÉ tr√°nh rate limit
                await new Promise(resolve => setTimeout(resolve, 300));
            }
            
            displayResults();
            
            const now = new Date().toLocaleString('vi-VN');
            document.getElementById('lastUpdate').textContent = `‚è∞ C·∫≠p nh·∫≠t l√∫c: ${now}`;
            
        } catch (error) {
            console.error('Error loading data:', error);
            document.getElementById('connectionStatus').textContent = 'L·ªói k·∫øt n·ªëi';
            document.getElementById('connectionStatus').className = 'status disconnected';
        } finally {
            refreshBtn.disabled = false;
            refreshBtn.textContent = 'üîÑ L√†m M·ªõi D·ªØ Li·ªáu';
        }
    }

    // T·ª± ƒë·ªông l√†m m·ªõi m·ªói 60 gi√¢y
    setInterval(loadAllData, 60000);

    // T·∫£i d·ªØ li·ªáu ban ƒë·∫ßu
    loadAllData();
</script>
```

</body>
</html>
