<!DOCTYPE html>

<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ph√¢n T√≠ch XAU/USD Chuy√™n Nghi·ªáp</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        padding: 20px;
        min-height: 100vh;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
    }

    .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        margin-bottom: 30px;
        text-align: center;
    }

    .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .header .subtitle {
        font-size: 1.1em;
        opacity: 0.95;
    }

    .price-section {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        margin-bottom: 25px;
    }

    .current-price {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px;
    }

    .price-box {
        flex: 1;
        min-width: 200px;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 12px;
        text-align: center;
    }

    .price-box.bid {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .price-box.ask {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }

    .price-label {
        font-size: 0.9em;
        opacity: 0.9;
        margin-bottom: 8px;
    }

    .price-value {
        font-size: 2.2em;
        font-weight: bold;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }

    .price-change {
        font-size: 1.1em;
        margin-top: 8px;
    }

    .grid-layout {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 25px;
        margin-bottom: 25px;
    }

    .card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }

    .card h2 {
        color: #667eea;
        margin-bottom: 20px;
        font-size: 1.5em;
        border-bottom: 3px solid #667eea;
        padding-bottom: 10px;
    }

    .timeframe-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }

    .tab-btn {
        padding: 10px 20px;
        border: 2px solid #667eea;
        background: white;
        color: #667eea;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s;
    }

    .tab-btn:hover {
        background: #667eea;
        color: white;
        transform: translateY(-2px);
    }

    .tab-btn.active {
        background: #667eea;
        color: white;
    }

    .analysis-content {
        display: none;
    }

    .analysis-content.active {
        display: block;
    }

    .signal-box {
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 20px;
        border-left: 5px solid;
    }

    .signal-box.buy {
        background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%);
        border-color: #2ecc71;
    }

    .signal-box.sell {
        background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        border-color: #e74c3c;
    }

    .signal-box.neutral {
        background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
        border-color: #3498db;
    }

    .signal-header {
        font-size: 1.4em;
        font-weight: bold;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .entry-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }

    .entry-item {
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .entry-label {
        font-size: 0.85em;
        color: #666;
        margin-bottom: 5px;
        text-transform: uppercase;
        font-weight: bold;
    }

    .entry-value {
        font-size: 1.3em;
        font-weight: bold;
        color: #333;
    }

    .indicators-list {
        list-style: none;
    }

    .indicators-list li {
        padding: 12px;
        margin-bottom: 10px;
        background: #f8f9fa;
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .indicator-name {
        font-weight: bold;
        color: #333;
    }

    .indicator-value {
        color: #667eea;
        font-weight: bold;
    }

    .ai-section {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        margin-bottom: 25px;
    }

    .ai-section h2 {
        color: white;
        border-color: white;
    }

    .api-input-group {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }

    .api-input-group select,
    .api-input-group input {
        flex: 1;
        min-width: 200px;
        padding: 12px;
        border: 2px solid white;
        border-radius: 8px;
        font-size: 1em;
    }

    .btn {
        padding: 12px 30px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1em;
        font-weight: bold;
        transition: all 0.3s;
        text-transform: uppercase;
    }

    .btn-primary {
        background: white;
        color: #667eea;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    .btn-primary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    .ai-response {
        background: white;
        color: #333;
        padding: 20px;
        border-radius: 12px;
        margin-top: 20px;
        min-height: 100px;
        max-height: 400px;
        overflow-y: auto;
        display: none;
    }

    .ai-response.show {
        display: block;
    }

    .loading {
        text-align: center;
        padding: 20px;
    }

    .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .update-time {
        text-align: center;
        color: #666;
        font-size: 0.9em;
        margin-top: 20px;
        padding: 10px;
        background: white;
        border-radius: 8px;
    }

    .status-badge {
        display: inline-block;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.85em;
        font-weight: bold;
        margin-left: 10px;
    }

    .status-badge.live {
        background: #2ecc71;
        color: white;
    }

    .recommendation {
        background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        padding: 20px;
        border-radius: 12px;
        margin-top: 20px;
        border-left: 5px solid #ff6b6b;
    }

    .recommendation h3 {
        color: #333;
        margin-bottom: 15px;
    }

    .recommendation ul {
        list-style-position: inside;
        color: #555;
    }

    .recommendation li {
        margin-bottom: 10px;
        line-height: 1.6;
    }

    @media (max-width: 768px) {
        .header h1 {
            font-size: 1.8em;
        }

        .grid-layout {
            grid-template-columns: 1fr;
        }

        .price-value {
            font-size: 1.8em;
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Ph√¢n T√≠ch XAU/USD Chuy√™n Nghi·ªáp</h1>
            <p class="subtitle">Ph√¢n t√≠ch k·ªπ thu·∫≠t ƒëa khung th·ªùi gian v·ªõi d·ªØ li·ªáu m√¥ ph·ªèng th·ªùi gian th·ª±c</p>
            <p style="font-size: 0.9em; opacity: 0.9; margin-top: 10px;">üí° Gi√° dao ƒë·ªông th·ª±c t·∫ø d·ª±a tr√™n thu·∫≠t to√°n m√¥ ph·ªèng th·ªã tr∆∞·ªùng XAU/USD</p>
        </div>

```
    <!-- Current Price Section -->
    <div class="price-section">
        <div class="current-price">
            <div class="price-box">
                <div class="price-label">GI√Å HI·ªÜN T·∫†I</div>
                <div class="price-value" id="currentPrice">Loading...</div>
                <div class="price-change" id="priceChange">-</div>
            </div>
            <div class="price-box bid">
                <div class="price-label">GI√Å BID</div>
                <div class="price-value" id="bidPrice">Loading...</div>
            </div>
            <div class="price-box ask">
                <div class="price-label">GI√Å ASK</div>
                <div class="price-value" id="askPrice">Loading...</div>
            </div>
        </div>
        <div class="update-time">
            <span class="status-badge live" id="dataStatus">‚óè KH·ªûI ƒê·ªòNG</span>
            C·∫≠p nh·∫≠t l·∫ßn cu·ªëi: <span id="updateTime">-</span>
        </div>
    </div>

    <!-- Multi-Timeframe Analysis -->
    <div class="card">
        <h2>üéØ Ph√¢n T√≠ch ƒêa Khung Th·ªùi Gian</h2>
        <div class="timeframe-tabs">
            <button class="tab-btn active" onclick="showTimeframe('m5')">M5 (Scalping)</button>
            <button class="tab-btn" onclick="showTimeframe('m15')">M15 (Intraday)</button>
            <button class="tab-btn" onclick="showTimeframe('h1')">H1 (Day Trade)</button>
            <button class="tab-btn" onclick="showTimeframe('h4')">H4 (Swing)</button>
            <button class="tab-btn" onclick="showTimeframe('d1')">D1 (Position)</button>
        </div>

        <div id="m5" class="analysis-content active">
            <div class="signal-box buy" id="signal-m5">
                <div class="signal-header">
                    <span>üî• SCALPING M5</span>
                    <span class="status-badge live">ƒêang ph√¢n t√≠ch...</span>
                </div>
                <div class="entry-details">
                    <div class="entry-item">
                        <div class="entry-label">Entry Point</div>
                        <div class="entry-value" id="entry-m5">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Stop Loss</div>
                        <div class="entry-value" id="sl-m5">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Take Profit 1</div>
                        <div class="entry-value" id="tp1-m5">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Take Profit 2</div>
                        <div class="entry-value" id="tp2-m5">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Risk/Reward</div>
                        <div class="entry-value" id="rr-m5">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Xu H∆∞·ªõng</div>
                        <div class="entry-value" id="trend-m5">-</div>
                    </div>
                </div>
                <div class="recommendation" id="rec-m5">
                    <h3>üí° G·ª£i √ù Trading:</h3>
                    <ul>
                        <li>ƒêang ph√¢n t√≠ch d·ªØ li·ªáu...</li>
                    </ul>
                </div>
            </div>

            <h3 style="margin: 20px 0; color: #667eea;">üìà Ch·ªâ B√°o K·ªπ Thu·∫≠t M5</h3>
            <ul class="indicators-list" id="indicators-m5">
                <li><span class="indicator-name">ƒêang t·∫£i...</span></li>
            </ul>
        </div>

        <div id="m15" class="analysis-content">
            <div class="signal-box neutral" id="signal-m15">
                <div class="signal-header">
                    <span>‚ö° INTRADAY M15</span>
                    <span class="status-badge live">ƒêang ph√¢n t√≠ch...</span>
                </div>
                <div class="entry-details">
                    <div class="entry-item">
                        <div class="entry-label">Entry Point</div>
                        <div class="entry-value" id="entry-m15">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Stop Loss</div>
                        <div class="entry-value" id="sl-m15">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Take Profit 1</div>
                        <div class="entry-value" id="tp1-m15">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Take Profit 2</div>
                        <div class="entry-value" id="tp2-m15">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Risk/Reward</div>
                        <div class="entry-value" id="rr-m15">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Xu H∆∞·ªõng</div>
                        <div class="entry-value" id="trend-m15">-</div>
                    </div>
                </div>
                <div class="recommendation" id="rec-m15">
                    <h3>üí° G·ª£i √ù Trading:</h3>
                    <ul>
                        <li>ƒêang ph√¢n t√≠ch d·ªØ li·ªáu...</li>
                    </ul>
                </div>
            </div>

            <h3 style="margin: 20px 0; color: #667eea;">üìà Ch·ªâ B√°o K·ªπ Thu·∫≠t M15</h3>
            <ul class="indicators-list" id="indicators-m15">
                <li><span class="indicator-name">ƒêang t·∫£i...</span></li>
            </ul>
        </div>

        <div id="h1" class="analysis-content">
            <div class="signal-box sell" id="signal-h1">
                <div class="signal-header">
                    <span>üìä DAY TRADE H1</span>
                    <span class="status-badge live">ƒêang ph√¢n t√≠ch...</span>
                </div>
                <div class="entry-details">
                    <div class="entry-item">
                        <div class="entry-label">Entry Point</div>
                        <div class="entry-value" id="entry-h1">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Stop Loss</div>
                        <div class="entry-value" id="sl-h1">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Take Profit 1</div>
                        <div class="entry-value" id="tp1-h1">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Take Profit 2</div>
                        <div class="entry-value" id="tp2-h1">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Risk/Reward</div>
                        <div class="entry-value" id="rr-h1">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Xu H∆∞·ªõng</div>
                        <div class="entry-value" id="trend-h1">-</div>
                    </div>
                </div>
                <div class="recommendation" id="rec-h1">
                    <h3>üí° G·ª£i √ù Trading:</h3>
                    <ul>
                        <li>ƒêang ph√¢n t√≠ch d·ªØ li·ªáu...</li>
                    </ul>
                </div>
            </div>

            <h3 style="margin: 20px 0; color: #667eea;">üìà Ch·ªâ B√°o K·ªπ Thu·∫≠t H1</h3>
            <ul class="indicators-list" id="indicators-h1">
                <li><span class="indicator-name">ƒêang t·∫£i...</span></li>
            </ul>
        </div>

        <div id="h4" class="analysis-content">
            <div class="signal-box buy" id="signal-h4">
                <div class="signal-header">
                    <span>üéØ SWING H4</span>
                    <span class="status-badge live">ƒêang ph√¢n t√≠ch...</span>
                </div>
                <div class="entry-details">
                    <div class="entry-item">
                        <div class="entry-label">Entry Point</div>
                        <div class="entry-value" id="entry-h4">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Stop Loss</div>
                        <div class="entry-value" id="sl-h4">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Take Profit 1</div>
                        <div class="entry-value" id="tp1-h4">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Take Profit 2</div>
                        <div class="entry-value" id="tp2-h4">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Risk/Reward</div>
                        <div class="entry-value" id="rr-h4">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Xu H∆∞·ªõng</div>
                        <div class="entry-value" id="trend-h4">-</div>
                    </div>
                </div>
                <div class="recommendation" id="rec-h4">
                    <h3>üí° G·ª£i √ù Trading:</h3>
                    <ul>
                        <li>ƒêang ph√¢n t√≠ch d·ªØ li·ªáu...</li>
                    </ul>
                </div>
            </div>

            <h3 style="margin: 20px 0; color: #667eea;">üìà Ch·ªâ B√°o K·ªπ Thu·∫≠t H4</h3>
            <ul class="indicators-list" id="indicators-h4">
                <li><span class="indicator-name">ƒêang t·∫£i...</span></li>
            </ul>
        </div>

        <div id="d1" class="analysis-content">
            <div class="signal-box neutral" id="signal-d1">
                <div class="signal-header">
                    <span>üìÖ POSITION D1</span>
                    <span class="status-badge live">ƒêang ph√¢n t√≠ch...</span>
                </div>
                <div class="entry-details">
                    <div class="entry-item">
                        <div class="entry-label">Entry Point</div>
                        <div class="entry-value" id="entry-d1">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Stop Loss</div>
                        <div class="entry-value" id="sl-d1">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Take Profit 1</div>
                        <div class="entry-value" id="tp1-d1">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Take Profit 2</div>
                        <div class="entry-value" id="tp2-d1">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Risk/Reward</div>
                        <div class="entry-value" id="rr-d1">-</div>
                    </div>
                    <div class="entry-item">
                        <div class="entry-label">Xu H∆∞·ªõng</div>
                        <div class="entry-value" id="trend-d1">-</div>
                    </div>
                </div>
                <div class="recommendation" id="rec-d1">
                    <h3>üí° G·ª£i √ù Trading:</h3>
                    <ul>
                        <li>ƒêang ph√¢n t√≠ch d·ªØ li·ªáu...</li>
                    </ul>
                </div>
            </div>

            <h3 style="margin: 20px 0; color: #667eea;">üìà Ch·ªâ B√°o K·ªπ Thu·∫≠t D1</h3>
            <ul class="indicators-list" id="indicators-d1">
                <li><span class="indicator-name">ƒêang t·∫£i...</span></li>
            </ul>
        </div>
    </div>

    <!-- AI Analysis Section -->
    <div class="ai-section">
        <h2>ü§ñ Ph√¢n T√≠ch B·∫±ng AI (Claude/OpenAI)</h2>
        <p style="margin-bottom: 20px; opacity: 0.95;">Nh·∫≠p API key ƒë·ªÉ nh·∫≠n ph√¢n t√≠ch chuy√™n s√¢u t·ª´ AI v·ªõi d·ªØ li·ªáu th·ªùi gian th·ª±c</p>
        
        <div class="api-input-group">
            <select id="aiProvider">
                <option value="claude">Claude AI</option>
                <option value="openai">OpenAI</option>
            </select>
            <input type="password" id="apiKey" placeholder="Nh·∫≠p API Key c·ªßa b·∫°n...">
            <button class="btn btn-primary" onclick="analyzeWithAI()" id="aiBtn">
                Ph√¢n T√≠ch V·ªõi AI
            </button>
        </div>

        <div class="ai-response" id="aiResponse">
            <h3 style="color: #667eea; margin-bottom: 15px;">K·∫øt Qu·∫£ Ph√¢n T√≠ch AI:</h3>
            <div id="aiContent"></div>
        </div>
    </div>
</div>

<script>
    // Global variables
    let marketData = {
        price: 2650.50,
        bid: 2650.25,
        ask: 2650.75,
        change: 0,
        changePercent: 0,
        high: 2655.00,
        low: 2645.00,
        volume: 0,
        previousPrice: 2650.50,
        sessionHigh: 2655.00,
        sessionLow: 2645.00
    };

    let technicalData = {};

    // Initialize on page load
    window.addEventListener('load', function() {
        // Display initial prices immediately
        updatePriceDisplay();
        analyzeAllTimeframes();
        
        // Then start live updates
        setInterval(function() {
            simulateMarketData();
        }, 2000);
    });

    // Simulate market data with realistic movements
    function simulateMarketData() {
        // Simulate realistic tick-by-tick price movement
        const tickSize = 0.10; // $0.10 minimum movement
        const maxTicks = 8; // Max 8 ticks per update
        const direction = Math.random() > 0.5 ? 1 : -1;
        const ticks = Math.floor(Math.random() * maxTicks) + 1;
        const priceChange = direction * ticks * tickSize;
        
        // Update price
        marketData.previousPrice = marketData.price;
        marketData.price = parseFloat((marketData.price + priceChange).toFixed(2));
        
        // Update session high/low
        if (marketData.price > marketData.sessionHigh) {
            marketData.sessionHigh = marketData.price;
        }
        if (marketData.price < marketData.sessionLow) {
            marketData.sessionLow = marketData.price;
        }
        
        // Calculate bid/ask spread (typical 0.50 for gold)
        marketData.bid = parseFloat((marketData.price - 0.25).toFixed(2));
        marketData.ask = parseFloat((marketData.price + 0.25).toFixed(2));
        
        // Calculate change
        marketData.change = parseFloat(priceChange.toFixed(2));
        marketData.changePercent = parseFloat(((priceChange / marketData.previousPrice) * 100).toFixed(2));
        
        // Use session high/low
        marketData.high = marketData.sessionHigh;
        marketData.low = marketData.sessionLow;
        
        // Update display
        updatePriceDisplay();
        analyzeAllTimeframes();
        
        // Update status badge
        document.getElementById('dataStatus').textContent = '‚óè LIVE SIMULATION';
        document.getElementById('dataStatus').style.background = '#3498db';
    }

    // Update price display
    function updatePriceDisplay() {
        document.getElementById('currentPrice').textContent = marketData.price.toFixed(2);
        document.getElementById('bidPrice').textContent = marketData.bid.toFixed(2);
        document.getElementById('askPrice').textContent = marketData.ask.toFixed(2);
        
        const changeEl = document.getElementById('priceChange');
        const changeText = `${marketData.change >= 0 ? '+' : ''}${marketData.change.toFixed(2)} (${marketData.changePercent >= 0 ? '+' : ''}${marketData.changePercent.toFixed(2)}%)`;
        changeEl.textContent = changeText;
        changeEl.style.color = marketData.change >= 0 ? '#2ecc71' : '#e74c3c';
        
        const now = new Date();
        document.getElementById('updateTime').textContent = now.toLocaleTimeString('vi-VN');
    }

    // Calculate technical indicators
    function calculateIndicators(timeframe) {
        const price = marketData.price;
        const high = marketData.high;
        const low = marketData.low;
        
        // Simple Moving Averages (simulated based on current price)
        const sma20 = price + (Math.random() - 0.5) * 5;
        const sma50 = price + (Math.random() - 0.5) * 10;
        const ema20 = price + (Math.random() - 0.5) * 4;
        
        // RSI (simulated)
        const rsi = 30 + Math.random() * 40;
        
        // MACD (simulated)
        const macd = (Math.random() - 0.5) * 2;
        const signal = (Math.random() - 0.5) * 2;
        
        // Bollinger Bands
        const bb_middle = price;
        const bb_upper = price + (high - low) * 1.5;
        const bb_lower = price - (high - low) * 1.5;
        
        // Stochastic
        const stoch_k = 20 + Math.random() * 60;
        const stoch_d = 20 + Math.random() * 60;
        
        return {
            sma20: sma20.toFixed(2),
            sma50: sma50.toFixed(2),
            ema20: ema20.toFixed(2),
            rsi: rsi.toFixed(2),
            macd: macd.toFixed(3),
            signal: signal.toFixed(3),
            bb_upper: bb_upper.toFixed(2),
            bb_middle: bb_middle.toFixed(2),
            bb_lower: bb_lower.toFixed(2),
            stoch_k: stoch_k.toFixed(2),
            stoch_d: stoch_d.toFixed(2)
        };
    }

    // Analyze all timeframes
    function analyzeAllTimeframes() {
        const timeframes = ['m5', 'm15', 'h1', 'h4', 'd1'];
        
        timeframes.forEach(tf => {
            const indicators = calculateIndicators(tf);
            technicalData[tf] = indicators;
            
            // Determine signal
            const signal = determineSignal(indicators, tf);
            
            // Update UI
            updateTimeframeAnalysis(tf, signal, indicators);
        });
    }

    // Determine trading signal
    function determineSignal(indicators, timeframe) {
        const price = marketData.price;
        const rsi = parseFloat(indicators.rsi);
        const macd = parseFloat(indicators.macd);
        const signal_line = parseFloat(indicators.signal);
        const sma20 = parseFloat(indicators.sma20);
        const ema20 = parseFloat(indicators.ema20);
        
        let buySignals = 0;
        let sellSignals = 0;
        
        // RSI analysis
        if (rsi < 30) buySignals += 2;
        else if (rsi > 70) sellSignals += 2;
        else if (rsi < 40) buySignals += 1;
        else if (rsi > 60) sellSignals += 1;
        
        // MACD analysis
        if (macd > signal_line && macd > 0) buySignals += 2;
        else if (macd < signal_line && macd < 0) sellSignals += 2;
        
        // Moving averages
        if (price > sma20 && price > ema20) buySignals += 1;
        else if (price < sma20 && price < ema20) sellSignals += 1;
        
        // Price vs Bollinger Bands
        const bb_upper = parseFloat(indicators.bb_upper);
        const bb_lower = parseFloat(indicators.bb_lower);
        if (price < bb_lower) buySignals += 1;
        else if (price > bb_upper) sellSignals += 1;
        
        // Stochastic
        const stoch_k = parseFloat(indicators.stoch_k);
        if (stoch_k < 20) buySignals += 1;
        else if (stoch_k > 80) sellSignals += 1;
        
        // Calculate entry, SL, TP based on timeframe
        let atrMultiplier = 1;
        let tpMultiplier = 2;
        
        switch(timeframe) {
            case 'm5':
                atrMultiplier = 1;
                tpMultiplier = 1.5;
                break;
            case 'm15':
                atrMultiplier = 1.5;
                tpMultiplier = 2;
                break;
            case 'h1':
                atrMultiplier = 2;
                tpMultiplier = 2.5;
                break;
            case 'h4':
                atrMultiplier = 3;
                tpMultiplier = 3;
                break;
            case 'd1':
                atrMultiplier = 5;
                tpMultiplier = 4;
                break;
        }
        
        const atr = (marketData.high - marketData.low) * atrMultiplier;
        
        let signalType, entry, sl, tp1, tp2, recommendations;
        
        if (buySignals > sellSignals) {
            signalType = 'BUY';
            entry = marketData.ask;
            sl = entry - atr;
            tp1 = entry + (atr * tpMultiplier);
            tp2 = entry + (atr * tpMultiplier * 1.5);
            recommendations = [
                `V√†o l·ªánh BUY t·∫°i ${entry.toFixed(2)} khi gi√° tƒÉng`,
                `ƒê·∫∑t Stop Loss t·∫°i ${sl.toFixed(2)} ƒë·ªÉ b·∫£o v·ªá v·ªën`,
                `Take Profit 1 t·∫°i ${tp1.toFixed(2)} (Close 50% l·ªánh)`,
                `Take Profit 2 t·∫°i ${tp2.toFixed(2)} (Close 50% c√≤n l·∫°i)`,
                `Risk/Reward ratio: 1:${tpMultiplier.toFixed(1)}`,
                `Theo d√µi RSI v√† MACD ƒë·ªÉ x√°c nh·∫≠n xu h∆∞·ªõng`
            ];
        } else if (sellSignals > buySignals) {
            signalType = 'SELL';
            entry = marketData.bid;
            sl = entry + atr;
            tp1 = entry - (atr * tpMultiplier);
            tp2 = entry - (atr * tpMultiplier * 1.5);
            recommendations = [
                `V√†o l·ªánh SELL t·∫°i ${entry.toFixed(2)} khi gi√° gi·∫£m`,
                `ƒê·∫∑t Stop Loss t·∫°i ${sl.toFixed(2)} ƒë·ªÉ b·∫£o v·ªá v·ªën`,
                `Take Profit 1 t·∫°i ${tp1.toFixed(2)} (Close 50% l·ªánh)`,
                `Take Profit 2 t·∫°i ${tp2.toFixed(2)} (Close 50% c√≤n l·∫°i)`,
                `Risk/Reward ratio: 1:${tpMultiplier.toFixed(1)}`,
                `Ch√∫ √Ω ph√¢n k·ª≥ gi√° v√† ch·ªâ b√°o`
            ];
        } else {
            signalType = 'NEUTRAL';
            entry = marketData.price;
            sl = entry - atr;
            tp1 = entry + (atr * tpMultiplier);
            tp2 = entry + (atr * tpMultiplier * 1.5);
            recommendations = [
                `Th·ªã tr∆∞·ªùng ƒëang sideway, ch·ªù t√≠n hi·ªáu r√µ r√†ng h∆°n`,
                `C√≥ th·ªÉ ƒë·∫∑t l·ªánh pending ·ªü c·∫£ 2 chi·ªÅu`,
                `BUY Stop t·∫°i ${(entry + 5).toFixed(2)}, SL: ${(entry - atr + 5).toFixed(2)}`,
                `SELL Stop t·∫°i ${(entry - 5).toFixed(2)}, SL: ${(entry + atr - 5).toFixed(2)}`,
                `Theo d√µi breakout t·ª´ v√πng consolidation`,
                `Qu·∫£n l√Ω risk nghi√™m ng·∫∑t trong giai ƒëo·∫°n n√†y`
            ];
        }
        
        const rr = ((tp1 - entry) / (entry - sl)).toFixed(2);
        
        return {
            type: signalType,
            entry: entry.toFixed(2),
            sl: sl.toFixed(2),
            tp1: tp1.toFixed(2),
            tp2: tp2.toFixed(2),
            rr: rr,
            trend: buySignals > sellSignals ? 'üìà TƒÉng' : sellSignals > buySignals ? 'üìâ Gi·∫£m' : '‚û°Ô∏è Sideway',
            recommendations: recommendations
        };
    }

    // Update timeframe analysis display
    function updateTimeframeAnalysis(timeframe, signal, indicators) {
        // Update signal box class
        const signalBox = document.getElementById(`signal-${timeframe}`);
        signalBox.className = 'signal-box';
        if (signal.type === 'BUY') {
            signalBox.classList.add('buy');
        } else if (signal.type === 'SELL') {
            signalBox.classList.add('sell');
        } else {
            signalBox.classList.add('neutral');
        }
        
        // Update entry details
        document.getElementById(`entry-${timeframe}`).textContent = signal.entry;
        document.getElementById(`sl-${timeframe}`).textContent = signal.sl;
        document.getElementById(`tp1-${timeframe}`).textContent = signal.tp1;
        document.getElementById(`tp2-${timeframe}`).textContent = signal.tp2;
        document.getElementById(`rr-${timeframe}`).textContent = `1:${signal.rr}`;
        document.getElementById(`trend-${timeframe}`).textContent = signal.trend;
        
        // Update recommendations
        const recEl = document.getElementById(`rec-${timeframe}`);
        recEl.innerHTML = '<h3>üí° G·ª£i √ù Trading:</h3><ul>' + 
            signal.recommendations.map(r => `<li>${r}</li>`).join('') + 
            '</ul>';
        
        // Update indicators
        const indicatorsList = document.getElementById(`indicators-${timeframe}`);
        indicatorsList.innerHTML = `
            <li>
                <span class="indicator-name">RSI (14)</span>
                <span class="indicator-value">${indicators.rsi}</span>
            </li>
            <li>
                <span class="indicator-name">MACD</span>
                <span class="indicator-value">${indicators.macd}</span>
            </li>
            <li>
                <span class="indicator-name">Signal Line</span>
                <span class="indicator-value">${indicators.signal}</span>
            </li>
            <li>
                <span class="indicator-name">SMA (20)</span>
                <span class="indicator-value">${indicators.sma20}</span>
            </li>
            <li>
                <span class="indicator-name">SMA (50)</span>
                <span class="indicator-value">${indicators.sma50}</span>
            </li>
            <li>
                <span class="indicator-name">EMA (20)</span>
                <span class="indicator-value">${indicators.ema20}</span>
            </li>
            <li>
                <span class="indicator-name">Bollinger Bands Upper</span>
                <span class="indicator-value">${indicators.bb_upper}</span>
            </li>
            <li>
                <span class="indicator-name">Bollinger Bands Middle</span>
                <span class="indicator-value">${indicators.bb_middle}</span>
            </li>
            <li>
                <span class="indicator-name">Bollinger Bands Lower</span>
                <span class="indicator-value">${indicators.bb_lower}</span>
            </li>
            <li>
                <span class="indicator-name">Stochastic %K</span>
                <span class="indicator-value">${indicators.stoch_k}</span>
            </li>
            <li>
                <span class="indicator-name">Stochastic %D</span>
                <span class="indicator-value">${indicators.stoch_d}</span>
            </li>
        `;
    }

    // Switch timeframe tabs
    function showTimeframe(timeframe) {
        // Hide all contents
        const contents = document.querySelectorAll('.analysis-content');
        contents.forEach(c => c.classList.remove('active'));
        
        // Remove active class from all tabs
        const tabs = document.querySelectorAll('.tab-btn');
        tabs.forEach(t => t.classList.remove('active'));
        
        // Show selected content
        document.getElementById(timeframe).classList.add('active');
        
        // Add active class to clicked tab
        event.target.classList.add('active');
    }

    // Analyze with AI
    async function analyzeWithAI() {
        const provider = document.getElementById('aiProvider').value;
        const apiKey = document.getElementById('apiKey').value.trim();
        
        if (!apiKey) {
            alert('Vui l√≤ng nh·∫≠p API Key!');
            return;
        }
        
        const aiBtn = document.getElementById('aiBtn');
        const aiResponse = document.getElementById('aiResponse');
        const aiContent = document.getElementById('aiContent');
        
        // Show loading
        aiBtn.disabled = true;
        aiBtn.textContent = 'ƒêang Ph√¢n T√≠ch...';
        aiResponse.classList.add('show');
        aiContent.innerHTML = '<div class="loading"><div class="spinner"></div><p>AI ƒëang ph√¢n t√≠ch d·ªØ li·ªáu th·ªã tr∆∞·ªùng...</p></div>';
        
        // Prepare data for AI
        const analysisData = {
            symbol: 'XAU/USD',
            currentPrice: marketData.price,
            bid: marketData.bid,
            ask: marketData.ask,
            change: marketData.change,
            changePercent: marketData.changePercent,
            high: marketData.high,
            low: marketData.low,
            timeframes: technicalData,
            timestamp: new Date().toISOString()
        };
        
        try {
            let aiAnalysis;
            
            if (provider === 'claude') {
                aiAnalysis = await analyzeWithClaude(apiKey, analysisData);
            } else {
                aiAnalysis = await analyzeWithOpenAI(apiKey, analysisData);
            }
            
            aiContent.innerHTML = `<div style="white-space: pre-wrap; line-height: 1.8;">${aiAnalysis}</div>`;
        } catch (error) {
            aiContent.innerHTML = `<p style="color: #e74c3c;"><strong>‚ùå L·ªói:</strong> ${error.message}</p>
                <p style="margin-top: 10px;">Vui l√≤ng ki·ªÉm tra l·∫°i API Key v√† th·ª≠ l·∫°i.</p>`;
        } finally {
            aiBtn.disabled = false;
            aiBtn.textContent = 'Ph√¢n T√≠ch V·ªõi AI';
        }
    }

    // Analyze with Claude
    async function analyzeWithClaude(apiKey, data) {
        const response = await fetch('https://api.anthropic.com/v1/messages', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'x-api-key': apiKey,
                'anthropic-version': '2023-06-01'
            },
            body: JSON.stringify({
                model: 'claude-3-5-sonnet-20241022',
                max_tokens: 2000,
                messages: [{
                    role: 'user',
                    content: `B·∫°n l√† chuy√™n gia ph√¢n t√≠ch k·ªπ thu·∫≠t XAU/USD. H√£y ph√¢n t√≠ch d·ªØ li·ªáu th·ªã tr∆∞·ªùng sau v√† ƒë∆∞a ra nh·∫≠n ƒë·ªãnh chi ti·∫øt:
```

${JSON.stringify(data, null, 2)}

H√£y cung c·∫•p:

1. Nh·∫≠n ƒë·ªãnh t·ªïng quan v·ªÅ xu h∆∞·ªõng th·ªã tr∆∞·ªùng
1. Ph√¢n t√≠ch chi ti·∫øt c√°c ch·ªâ b√°o k·ªπ thu·∫≠t quan tr·ªçng
1. X√°c ƒë·ªãnh c√°c v√πng h·ªó tr·ª£/kh√°ng c·ª± ch√≠nh
1. ƒê·ªÅ xu·∫•t chi·∫øn l∆∞·ª£c giao d·ªãch c·ª• th·ªÉ cho t·ª´ng khung th·ªùi gian
1. C·∫£nh b√°o r·ªßi ro v√† l·ªùi khuy√™n qu·∫£n l√Ω v·ªën
1. D·ª± ƒëo√°n xu h∆∞·ªõng ng·∫Øn h·∫°n v√† trung h·∫°n

Tr·∫£ l·ªùi b·∫±ng ti·∫øng Vi·ªát, r√µ r√†ng v√† chi ti·∫øt.`
}]
})
});

```
        if (!response.ok) {
            throw new Error(`Claude API error: ${response.status}`);
        }
        
        const result = await response.json();
        return result.content[0].text;
    }

    // Analyze with OpenAI
    async function analyzeWithOpenAI(apiKey, data) {
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${apiKey}`
            },
            body: JSON.stringify({
                model: 'gpt-4-turbo-preview',
                messages: [{
                    role: 'system',
                    content: 'B·∫°n l√† chuy√™n gia ph√¢n t√≠ch k·ªπ thu·∫≠t XAU/USD v·ªõi nhi·ªÅu nƒÉm kinh nghi·ªám.'
                }, {
                    role: 'user',
                    content: `Ph√¢n t√≠ch chi ti·∫øt d·ªØ li·ªáu th·ªã tr∆∞·ªùng XAU/USD sau:
```

${JSON.stringify(data, null, 2)}

Cung c·∫•p:

1. Nh·∫≠n ƒë·ªãnh xu h∆∞·ªõng t·ªïng quan
1. Ph√¢n t√≠ch c√°c ch·ªâ b√°o k·ªπ thu·∫≠t
1. V√πng h·ªó tr·ª£/kh√°ng c·ª± quan tr·ªçng
1. Chi·∫øn l∆∞·ª£c giao d·ªãch cho t·ª´ng khung th·ªùi gian
1. Qu·∫£n l√Ω r·ªßi ro v√† v·ªën
1. D·ª± ƒëo√°n xu h∆∞·ªõng

Tr·∫£ l·ªùi b·∫±ng ti·∫øng Vi·ªát, chi ti·∫øt v√† d·ªÖ hi·ªÉu.`
}],
max_tokens: 2000,
temperature: 0.7
})
});

```
        if (!response.ok) {
            throw new Error(`OpenAI API error: ${response.status}`);
        }
        
        const result = await response.json();
        return result.choices[0].message.content;
    }
</script>
```

</body>
</html>
