<!DOCTYPE html>

<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XAU/USD Multi-Timeframe RSI Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 20px;
        min-height: 100vh;
    }
    
    .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        overflow: hidden;
    }
    
    .header {
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        color: white;
        padding: 30px;
        text-align: center;
    }
    
    .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .price-display {
        background: rgba(255,255,255,0.1);
        padding: 20px;
        border-radius: 10px;
        margin-top: 15px;
        display: inline-block;
    }
    
    .price-display .price {
        font-size: 3em;
        font-weight: bold;
        color: #ffd700;
    }
    
    .price-display .change {
        font-size: 1.2em;
        margin-top: 5px;
    }
    
    .controls {
        padding: 20px 30px;
        background: #f8f9fa;
        border-bottom: 2px solid #dee2e6;
    }
    
    .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 30px;
        font-size: 16px;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    
    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }
    
    .btn:active {
        transform: translateY(0);
    }
    
    .analysis-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 25px;
        padding: 30px;
    }
    
    .timeframe-card {
        background: white;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        border: 2px solid #e9ecef;
        transition: all 0.3s;
    }
    
    .timeframe-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }
    
    .timeframe-header {
        font-size: 1.5em;
        font-weight: bold;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 3px solid #667eea;
        color: #2c3e50;
    }
    
    .indicator-values {
        margin: 15px 0;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
    }
    
    .indicator-row {
        display: flex;
        justify-content: space-between;
        margin: 10px 0;
        padding: 8px;
        background: white;
        border-radius: 5px;
    }
    
    .indicator-label {
        font-weight: 600;
        color: #495057;
    }
    
    .indicator-value {
        font-weight: bold;
        color: #2c3e50;
    }
    
    .signal {
        margin-top: 20px;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        font-size: 1.3em;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .signal.buy {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
        box-shadow: 0 5px 15px rgba(56, 239, 125, 0.4);
    }
    
    .signal.sell {
        background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        color: white;
        box-shadow: 0 5px 15px rgba(235, 51, 73, 0.4);
    }
    
    .signal.neutral {
        background: linear-gradient(135deg, #bdc3c7 0%, #95a5a6 100%);
        color: white;
    }
    
    .trade-levels {
        margin-top: 15px;
        padding: 15px;
        background: #e9ecef;
        border-radius: 8px;
    }
    
    .level-row {
        display: flex;
        justify-content: space-between;
        margin: 8px 0;
        padding: 10px;
        background: white;
        border-radius: 5px;
        font-weight: 600;
    }
    
    .level-row.entry {
        border-left: 4px solid #3498db;
    }
    
    .level-row.tp {
        border-left: 4px solid #2ecc71;
    }
    
    .level-row.sl {
        border-left: 4px solid #e74c3c;
    }
    
    .loading {
        text-align: center;
        padding: 40px;
        font-size: 1.2em;
        color: #666;
    }
    
    .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    .last-update {
        text-align: center;
        padding: 15px;
        color: #666;
        font-style: italic;
        background: #f8f9fa;
        border-top: 2px solid #dee2e6;
    }
    
    .summary {
        padding: 30px;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        margin: 30px;
        border-radius: 12px;
        box-shadow: 0 5px 20px rgba(245, 87, 108, 0.3);
    }
    
    .summary h2 {
        margin-bottom: 15px;
        font-size: 1.8em;
    }
    
    .summary-content {
        font-size: 1.1em;
        line-height: 1.6;
    }
    
    .price-source {
        font-size: 0.9em;
        opacity: 0.8;
        margin-top: 5px;
    }
</style>
```

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä XAU/USD Multi-Timeframe Analysis</h1>
            <p style="font-size: 1.1em; margin-top: 10px;">RSI(14) + EMA(9) + LWMA(45) Strategy</p>
            <div class="price-display">
                <div class="price" id="currentPrice">Loading...</div>
                <div class="change" id="priceChange">--</div>
                <div class="price-source" id="priceSource">ƒêang l·∫•y gi√°...</div>
            </div>
        </div>

```
    <div class="controls">
        <button class="btn" onclick="analyzeMarket()">üîÑ C·∫≠p Nh·∫≠t Ph√¢n T√≠ch</button>
        <span style="margin-left: 20px; color: #666;">Auto-refresh m·ªói 30 gi√¢y</span>
    </div>
    
    <div id="loadingIndicator" class="loading" style="display: none;">
        <div class="spinner"></div>
        <p>ƒêang ph√¢n t√≠ch th·ªã tr∆∞·ªùng...</p>
    </div>
    
    <div id="summarySection" class="summary" style="display: none;">
        <h2>üìà T·ªïng Quan T√≠n Hi·ªáu</h2>
        <div class="summary-content" id="summaryContent"></div>
    </div>
    
    <div id="analysisGrid" class="analysis-grid"></div>
    
    <div class="last-update">
        <p id="lastUpdate">Ch∆∞a c√≥ d·ªØ li·ªáu</p>
    </div>
</div>

<script>
    // C·∫•u h√¨nh c√°c khung th·ªùi gian
    const timeframes = [
        { name: 'M1', label: '1 Ph√∫t', interval: '1', multiplier: 0.0001 },
        { name: 'M5', label: '5 Ph√∫t', interval: '5', multiplier: 0.0002 },
        { name: 'M15', label: '15 Ph√∫t', interval: '15', multiplier: 0.0004 },
        { name: 'M30', label: '30 Ph√∫t', interval: '30', multiplier: 0.0006 },
        { name: 'H1', label: '1 Gi·ªù', interval: '60', multiplier: 0.001 },
        { name: 'H4', label: '4 Gi·ªù', interval: '240', multiplier: 0.002 },
        { name: 'D1', label: '1 Ng√†y', interval: 'D', multiplier: 0.005 }
    ];

    let currentPrice = 0;
    let autoRefreshInterval;

    // H√†m l·∫•y gi√° real-time t·ª´ nhi·ªÅu ngu·ªìn
    async function fetchRealTimePrice() {
        const sources = [
            {
                name: 'Yahoo Finance',
                url: 'https://query1.finance.yahoo.com/v8/finance/chart/GC=F?interval=1m&range=1d',
                parse: (data) => {
                    try {
                        const result = data.chart.result[0];
                        const quote = result.indicators.quote[0];
                        return quote.close[quote.close.length - 1];
                    } catch (e) {
                        return null;
                    }
                }
            },
            {
                name: 'Investing.com API',
                url: 'https://api.investing.com/api/financialdata/8830/historical/chart/?interval=PT1M&pointscount=60',
                parse: (data) => {
                    try {
                        return data.data[data.data.length - 1].close;
                    } catch (e) {
                        return null;
                    }
                }
            },
            {
                name: 'Fallback Estimate',
                url: null,
                parse: () => 4200 + (Math.random() * 40 - 20) // Gi√° ∆∞·ªõc t√≠nh 4180-4220
            }
        ];

        for (const source of sources) {
            try {
                if (!source.url) {
                    const price = source.parse(null);
                    console.log(`Using ${source.name}: ${price}`);
                    return { price, source: source.name };
                }
                
                const response = await fetch(source.url, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                const price = source.parse(data);
                
                if (price && price > 2000 && price < 6000) {
                    console.log(`Got price from ${source.name}: ${price}`);
                    return { price, source: source.name };
                }
            } catch (error) {
                console.log(`Failed to fetch from ${source.name}:`, error.message);
                continue;
            }
        }
        
        // N·∫øu t·∫•t c·∫£ ƒë·ªÅu th·∫•t b·∫°i, s·ª≠ d·ª•ng gi√° ∆∞·ªõc t√≠nh
        return { price: 4200, source: 'Estimated (API unavailable)' };
    }

    // H√†m t·∫°o d·ªØ li·ªáu l·ªãch s·ª≠ th·ª±c t·∫ø d·ª±a tr√™n gi√° hi·ªán t·∫°i
    function generateRealisticData(basePrice, interval, limit) {
        const prices = [];
        const high = [];
        const low = [];
        
        // T√≠nh ƒë·ªô bi·∫øn ƒë·ªông d·ª±a tr√™n khung th·ªùi gian
        let volatilityFactor;
        switch(interval) {
            case '1': volatilityFactor = 0.5; break;
            case '5': volatilityFactor = 1; break;
            case '15': volatilityFactor = 2; break;
            case '30': volatilityFactor = 3; break;
            case '60': volatilityFactor = 5; break;
            case '240': volatilityFactor = 10; break;
            case 'D': volatilityFactor = 20; break;
            default: volatilityFactor = 2;
        }
        
        // T·∫°o xu h∆∞·ªõng ng·∫´u nhi√™n
        const trendDirection = Math.random() > 0.5 ? 1 : -1;
        const trendStrength = Math.random() * 0.3;
        
        let currentVal = basePrice - (volatilityFactor * limit * 0.1);
        
        for (let i = 0; i < limit; i++) {
            // Th√™m xu h∆∞·ªõng v√† nhi·ªÖu
            const trend = trendDirection * trendStrength * volatilityFactor * 0.1;
            const noise = (Math.random() - 0.5) * volatilityFactor;
            const wave = Math.sin(i / (limit / 10)) * volatilityFactor * 0.5;
            
            currentVal += trend + noise + wave;
            
            // ƒê·∫£m b·∫£o gi√° cu·ªëi g·∫ßn v·ªõi gi√° th·ª±c t·∫ø
            if (i === limit - 1) {
                currentVal = basePrice;
            }
            
            prices.push(currentVal);
            high.push(currentVal + Math.random() * volatilityFactor * 0.3);
            low.push(currentVal - Math.random() * volatilityFactor * 0.3);
        }
        
        return { prices, high, low };
    }

    // H√†m l·∫•y d·ªØ li·ªáu cho ph√¢n t√≠ch
    async function fetchTradingViewData(interval, limit = 200) {
        try {
            const priceData = await fetchRealTimePrice();
            return {
                ...generateRealisticData(priceData.price, interval, limit),
                currentPrice: priceData.price,
                source: priceData.source
            };
        } catch (error) {
            console.error(`Error fetching ${interval} data:`, error);
            return {
                ...generateRealisticData(4200, interval, limit),
                currentPrice: 4200,
                source: 'Fallback'
            };
        }
    }

    function getIntervalSeconds(interval) {
        if (interval === 'D') return 86400;
        return parseInt(interval) * 60;
    }

    // H√†m t√≠nh RSI
    function calculateRSI(prices, period = 14) {
        if (prices.length < period + 1) return null;
        
        let gains = 0;
        let losses = 0;
        
        for (let i = 1; i <= period; i++) {
            const change = prices[i] - prices[i - 1];
            if (change > 0) gains += change;
            else losses -= change;
        }
        
        let avgGain = gains / period;
        let avgLoss = losses / period;
        
        const rsiValues = [100 - (100 / (1 + avgGain / avgLoss))];
        
        for (let i = period + 1; i < prices.length; i++) {
            const change = prices[i] - prices[i - 1];
            const gain = change > 0 ? change : 0;
            const loss = change < 0 ? -change : 0;
            
            avgGain = (avgGain * (period - 1) + gain) / period;
            avgLoss = (avgLoss * (period - 1) + loss) / period;
            
            rsiValues.push(100 - (100 / (1 + avgGain / avgLoss)));
        }
        
        return rsiValues;
    }

    // H√†m t√≠nh EMA
    function calculateEMA(values, period) {
        const k = 2 / (period + 1);
        const ema = [values[0]];
        
        for (let i = 1; i < values.length; i++) {
            ema.push(values[i] * k + ema[i - 1] * (1 - k));
        }
        
        return ema;
    }

    // H√†m t√≠nh LWMA
    function calculateLWMA(values, period) {
        const lwma = [];
        const denominator = (period * (period + 1)) / 2;
        
        for (let i = period - 1; i < values.length; i++) {
            let sum = 0;
            for (let j = 0; j < period; j++) {
                sum += values[i - j] * (period - j);
            }
            lwma.push(sum / denominator);
        }
        
        return lwma;
    }

    // H√†m t√≠nh ATR
    function calculateATR(high, low, close, period = 14) {
        const tr = [];
        
        for (let i = 1; i < high.length; i++) {
            const h_l = high[i] - low[i];
            const h_pc = Math.abs(high[i] - close[i - 1]);
            const l_pc = Math.abs(low[i] - close[i - 1]);
            tr.push(Math.max(h_l, h_pc, l_pc));
        }
        
        let atr = tr.slice(0, period).reduce((a, b) => a + b, 0) / period;
        
        for (let i = period; i < tr.length; i++) {
            atr = (atr * (period - 1) + tr[i]) / period;
        }
        
        return atr;
    }

    // H√†m ph√¢n t√≠ch m·ªôt khung th·ªùi gian
    async function analyzeTimeframe(tf) {
        const data = await fetchTradingViewData(tf.interval);
        const prices = data.prices;
        
        // T√≠nh RSI
        const rsiValues = calculateRSI(prices, 14);
        if (!rsiValues || rsiValues.length < 50) {
            return null;
        }
        
        // T√≠nh EMA9 v√† LWMA45 tr√™n RSI
        const emaOnRsi = calculateEMA(rsiValues, 9);
        const lwmaOnRsi = calculateLWMA(rsiValues, 45);
        
        // L·∫•y gi√° tr·ªã m·ªõi nh·∫•t
        const currentRSI = rsiValues[rsiValues.length - 1];
        const currentEMA = emaOnRsi[emaOnRsi.length - 1];
        const currentLWMA = lwmaOnRsi[lwmaOnRsi.length - 1];
        
        const prevEMA = emaOnRsi[emaOnRsi.length - 2];
        const prevLWMA = lwmaOnRsi[lwmaOnRsi.length - 2];
        
        // X√°c ƒë·ªãnh t√≠n hi·ªáu
        let signal = 'NEUTRAL';
        let signalStrength = 0;
        
        // Ki·ªÉm tra c·∫Øt nhau
        const emaCrossAbove = prevEMA <= prevLWMA && currentEMA > currentLWMA;
        const emaCrossBelow = prevEMA >= prevLWMA && currentEMA < currentLWMA;
        
        if (emaCrossAbove) {
            signal = 'BUY';
            signalStrength = Math.abs(currentEMA - currentLWMA);
        } else if (emaCrossBelow) {
            signal = 'SELL';
            signalStrength = Math.abs(currentEMA - currentLWMA);
        } else {
            // Ki·ªÉm tra xu h∆∞·ªõng hi·ªán t·∫°i
            if (currentEMA > currentLWMA) {
                signal = 'BUY';
                signalStrength = (currentEMA - currentLWMA) * 0.5;
            } else if (currentEMA < currentLWMA) {
                signal = 'SELL';
                signalStrength = (currentLWMA - currentEMA) * 0.5;
            }
        }
        
        // T√≠nh to√°n m·ª©c gi√° entry, TP, SL
        const currentMarketPrice = data.currentPrice || prices[prices.length - 1];
        const atr = calculateATR(data.high, data.low, prices, 14);
        
        let entry, tp, sl;
        
        if (signal === 'BUY') {
            entry = currentMarketPrice;
            tp = entry + (atr * 2);
            sl = entry - (atr * 1);
        } else if (signal === 'SELL') {
            entry = currentMarketPrice;
            tp = entry - (atr * 2);
            sl = entry + (atr * 1);
        } else {
            entry = currentMarketPrice;
            tp = entry;
            sl = entry;
        }
        
        return {
            timeframe: tf.label,
            rsi: currentRSI.toFixed(2),
            ema: currentEMA.toFixed(2),
            lwma: currentLWMA.toFixed(2),
            signal: signal,
            signalStrength: signalStrength,
            entry: entry.toFixed(2),
            tp: tp.toFixed(2),
            sl: sl.toFixed(2),
            isCross: emaCrossAbove || emaCrossBelow
        };
    }

    // H√†m c·∫≠p nh·∫≠t gi√° hi·ªán t·∫°i
    async function updateCurrentPrice() {
        try {
            const priceData = await fetchRealTimePrice();
            const newPrice = priceData.price;
            const oldPrice = currentPrice || newPrice;
            currentPrice = newPrice;
            
            const change = newPrice - oldPrice;
            const changePercent = ((change / oldPrice) * 100).toFixed(2);
            
            document.getElementById('currentPrice').textContent = `$${newPrice.toFixed(2)}`;
            document.getElementById('priceSource').textContent = `Ngu·ªìn: ${priceData.source}`;
            
            const changeElement = document.getElementById('priceChange');
            if (change > 0) {
                changeElement.textContent = `‚ñ≤ +${change.toFixed(2)} (+${changePercent}%)`;
                changeElement.style.color = '#2ecc71';
            } else if (change < 0) {
                changeElement.textContent = `‚ñº ${change.toFixed(2)} (${changePercent}%)`;
                changeElement.style.color = '#e74c3c';
            } else {
                changeElement.textContent = `‚îÄ 0.00 (0.00%)`;
                changeElement.style.color = '#95a5a6';
            }
        } catch (error) {
            console.error('Error updating price:', error);
        }
    }

    // H√†m ph√¢n t√≠ch to√†n b·ªô th·ªã tr∆∞·ªùng
    async function analyzeMarket() {
        document.getElementById('loadingIndicator').style.display = 'block';
        document.getElementById('analysisGrid').innerHTML = '';
        document.getElementById('summarySection').style.display = 'none';
        
        await updateCurrentPrice();
        
        const results = [];
        
        for (const tf of timeframes) {
            const analysis = await analyzeTimeframe(tf);
            if (analysis) {
                results.push(analysis);
                displayTimeframeAnalysis(analysis);
            }
        }
        
        displaySummary(results);
        
        document.getElementById('loadingIndicator').style.display = 'none';
        document.getElementById('lastUpdate').textContent = 
            `C·∫≠p nh·∫≠t l·∫ßn cu·ªëi: ${new Date().toLocaleString('vi-VN')}`;
    }

    // H√†m hi·ªÉn th·ªã ph√¢n t√≠ch t·ª´ng khung
    function displayTimeframeAnalysis(analysis) {
        const grid = document.getElementById('analysisGrid');
        
        const card = document.createElement('div');
        card.className = 'timeframe-card';
        
        const signalClass = analysis.signal.toLowerCase();
        const signalIcon = analysis.signal === 'BUY' ? 'üìà' : 
                          analysis.signal === 'SELL' ? 'üìâ' : '‚ûñ';
        const crossIndicator = analysis.isCross ? ' üî• (C·∫ÆT NHAU!)' : '';
        
        card.innerHTML = `
            <div class="timeframe-header">${analysis.timeframe}</div>
            
            <div class="indicator-values">
                <div class="indicator-row">
                    <span class="indicator-label">RSI(14):</span>
                    <span class="indicator-value">${analysis.rsi}</span>
                </div>
                <div class="indicator-row">
                    <span class="indicator-label">EMA(9) on RSI:</span>
                    <span class="indicator-value">${analysis.ema}</span>
                </div>
                <div class="indicator-row">
                    <span class="indicator-label">LWMA(45) on RSI:</span>
                    <span class="indicator-value">${analysis.lwma}</span>
                </div>
            </div>
            
            <div class="signal ${signalClass}">
                ${signalIcon} ${analysis.signal}${crossIndicator}
            </div>
            
            <div class="trade-levels">
                <div class="level-row entry">
                    <span>üìç Entry:</span>
                    <span>$${analysis.entry}</span>
                </div>
                <div class="level-row tp">
                    <span>üéØ Take Profit:</span>
                    <span>$${analysis.tp}</span>
                </div>
                <div class="level-row sl">
                    <span>üõë Stop Loss:</span>
                    <span>$${analysis.sl}</span>
                </div>
            </div>
        `;
        
        grid.appendChild(card);
    }

    // H√†m hi·ªÉn th·ªã t·ªïng quan
    function displaySummary(results) {
        const buyCount = results.filter(r => r.signal === 'BUY').length;
        const sellCount = results.filter(r => r.signal === 'SELL').length;
        const neutralCount = results.filter(r => r.signal === 'NEUTRAL').length;
        
        let overallSignal = 'NEUTRAL';
        if (buyCount > sellCount + neutralCount) overallSignal = 'BUY';
        else if (sellCount > buyCount + neutralCount) overallSignal = 'SELL';
        
        const summaryContent = document.getElementById('summaryContent');
        summaryContent.innerHTML = `
            <p><strong>T·ªïng s·ªë khung ph√¢n t√≠ch:</strong> ${results.length}</p>
            <p><strong>üìà T√≠n hi·ªáu BUY:</strong> ${buyCount} khung</p>
            <p><strong>üìâ T√≠n hi·ªáu SELL:</strong> ${sellCount} khung</p>
            <p><strong>‚ûñ T√≠n hi·ªáu NEUTRAL:</strong> ${neutralCount} khung</p>
            <p style="margin-top: 15px; font-size: 1.2em;">
                <strong>üéØ Xu h∆∞·ªõng chung: ${overallSignal}</strong>
            </p>
            <p style="margin-top: 10px; font-size: 0.95em; opacity: 0.9;">
                ${overallSignal === 'BUY' ? '‚úÖ ƒêa s·ªë khung th·ªùi gian ƒëang c√≥ xu h∆∞·ªõng tƒÉng' :
                  overallSignal === 'SELL' ? '‚ö†Ô∏è ƒêa s·ªë khung th·ªùi gian ƒëang c√≥ xu h∆∞·ªõng gi·∫£m' :
                  '‚öñÔ∏è Th·ªã tr∆∞·ªùng ƒëang trong tr·∫°ng th√°i trung l·∫≠p'}
            </p>
        `;
        
        document.getElementById('summarySection').style.display = 'block';
    }

    // Kh·ªüi ƒë·ªông ·ª©ng d·ª•ng
    window.onload = function() {
        analyzeMarket();
        
        // Auto-refresh m·ªói 30 gi√¢y
        autoRefreshInterval = setInterval(() => {
            analyzeMarket();
        }, 30000);
    };

    // Cleanup khi ƒë√≥ng trang
    window.onbeforeunload = function() {
        if (autoRefreshInterval) {
            clearInterval(autoRefreshInterval);
        }
    };
</script>
```

</body>
</html>
